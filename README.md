<br/>
<p align="center">
  <h3 align="center">green-maps</h3>

  <p align="center">
    채식 지도 서비스 웹 앱
    <br/>
    <br/>
  </p>
</p>

<details open="true">
  <summary >Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started-with-screenshots">Getting Started with Screenshots</a>
      <ul>
        <li><a href="#map">Map</a></li>
        <li><a href="#review">Review</a></li>
        <li><a href="#my-list">My List</a></li>
        <li><a href="#community">Community</a></li>
        <li><a href="#my-page">My Page</a></li>
        <li><a href="#sign-up-sign-in">Sign up, Sign in</a></li>
      </ul>
    </li>
    <li>
        <a href="#trouble-shooting">Trouble Shooting</a>
    </li>
  </ol>
</details>

## About The Project

<img src="https://github.com/moonhee0507/green-maps/assets/102460056/314c2062-3b14-46b6-937a-fa52cd077d6d" alt="홈화면" width="700">

### Temporary Account

-   임시 계정 👉 ID: `test123` PW: `goodtoseeyou^9^`
    -   로그인이 필요한 서비스: `북마크`, `좋아요`, `게시글/댓글/식당 리뷰 작성`
-   PWA 다운로드 가능

### Summary

-   **데이터 구성**: 서울시 지정·인증업소 현황(800개) + 웹 스크래핑
-   **검색 모드**
    -   반경탐색 모드
        -   옵션: 300m, 500m (기본값), 1km, 2km, 3km
    -   지역탐색 모드
        -   옵션: 시도 / 시군구 (기본값: 현재 위치) \* 위치정보 허용 필수
    -   키워드 검색
        -   업종, 채식 인증 여부, 정렬 선택
        -   정렬 기본값: `관련도`
            -   `샐러디 화곡`을 검색했을 때 `샐러디 (화곡역점)`이 우선 검색
    -   공통: 업종필터
-   **식당 북마크(+ 좋아요)**

    -   북마크 그룹으로 관리(기본값: 기본그룹), 추가 및 이동
    -   좋아요 목록 확인

-   **게시판(커뮤니티)**

-   나머지 스크린샷 참조

<br />

## Built With

-   **Deployment**: [Vercel](https://github.com/vercel), [cloudtype](https://github.com/cloudtype)
-   **Build** : [vitejs](https://github.com/vitejs) with [vite-plugin-ssr](https://github.com/brillout/vite-plugin-ssr),
-   **Front-End**: [React](https://github.com/reactjs)
-   **Back-End**: [express](https://github.com/expressjs), [mongodb](https://github.com/mongodb), [AWS S3](https://github.com/aws?q=s3&type=all&language=&sort=)

## Getting Started with Screenshots

### Map

-   이 화면은 **위치 액세스 권한**이 허락되어야 사용할 수 있습니다.

-   화면을 이동하면 현재 뷰의 좌표를 기준으로 **해당 다각형 내에 있는 식당 정보**를 가져와 마커를 그립니다.

-   반경탐색 모드(기본값)와 지역탐색 모드 2가지가 있습니다.
    반경 선택 시 반경 표시가 화면 내에 들어오도록 지도 레벨이 조절됩니다.

| 첫화면                                                                                                                  | 반경탐색                                                                                                                | 반경탐색결과                                                                                                            |
| ----------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/4aed486d-6afa-4d6d-8ef7-68a652273660" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/2509dccb-bbcf-4f1c-83b9-9e9b9bcef11d" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/118422b1-95b9-49cf-b845-0902618e29f4" width="300"> |

<br />

-   지역 탐색 시 현재 위치의 시/도가 기본값입니다.
    주소 문자열을 나눠서 각각 시/도와 시군구로 분류한 후 선택한 지역의 식당 정보를 가져옵니다.

| 제자리로                                                                                                                               | 지역탐색                                                                                                                               | 지역탐색결과                                                                                                                               |
| -------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f1c9d31a-d6a0-44c3-b8d2-7275ddab8647" alt="제자리로" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/2269e632-cd26-4b77-a6c2-02d00b7a8eab" alt="지역탐색" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/49409d87-9ef1-4086-a18a-d4b02bfa6f1c" alt="지역탐색결과" width="300"> |

<br />

-   검색 시 쿼리스트링으로 시/도, 시군구, 업종, 검색어를 요청 메시지에 보냅니다. 거리순 정렬 기능도 있으므로 body에 현재 위치도 담아 서버에 요청합니다.

-   관련도 점수
    -   주소 7, 업종 3, 이름 2, 채식 인증 1
    -   주소 문자열은 법정동과 행정동이 같이 표기되어 있는 경우도 있기 때문에 검색어가 존재하는지만 검사합니다.
        e.g `...화곡로141(화곡동 698-2)`의 관련도 `...화곡로141`의 관련도와 같다.

| 업종필터                                                                                                                               | 검색                                                                                                                               | 검색결과                                                                                                                               |
| -------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/7d5b90df-30d8-4da1-b0b8-da898438e00a" alt="업종필터" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/62b306cf-0bc0-42a4-86f9-1ac5fd718246" alt="검색" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f1372211-e41c-48de-b852-991f528d3ac7" alt="검색결과" width="300"> |

<br />
<br />

### Review

-   식당 상세정보 페이지에서 리뷰를 작성할 수 있습니다.

| 첫화면                                                                                                                               | 버튼클릭                                                                                                                               | 리뷰작성                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/aa6b9d13-2d49-4422-b095-b18573d0612d" alt="첫화면" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/ad5e6548-8131-4db7-ab13-773eb433d8fe" alt="버튼클릭" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/5c487db0-b960-42ec-80a2-d8e4dab290e7" alt="리뷰작성" width="300"> |

<br />

-   이미지 처리 과정

    -   **URL.createObjectURL(File)**: 사용자에게 받은 이미지를 Object.createURL로 만듭니다.
    -   **랜덤파일명 생성**: 이미지별 랜덤 파일 이름을 생성해줍니다.
    -   **스토리지에 저장**: AWS S3로부터 signedUrl을 할당받고 해당 주소로 PUT 요청을 보냅니다.
    -   **db에 저장**: 스토리지에 저장이 완료되면 도큐먼트의 src 필드에 앞에서 생성한 랜덤 파일 이름을 저장합니다.

    -   **불러오기**: `<img src={IMAGE_URL/client/random_file_name.extension} alt="desc">` 형식으로 사용

| 리뷰작성 페이지                                                                                                                               | 결과                                                                                                                               | 텍스트 리뷰                                                                                                                               |
| --------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/d1889815-55d4-4179-bfcf-b3ff654fe14e" alt="리뷰작성 페이지" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/d5dba639-0950-4830-a070-abd7f1ab5ad2" alt="결과" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f7ca5171-b4b4-49db-92bb-5f360fe810ac" alt="텍스트 리뷰" width="300"> |

<br />

-   수정 시 이미지가 있을 경우 완료 버튼 클릭 시 src에 `amazon` 문자열이 있는지 확인합니다.
    -   `amazon` 문자열이 포함되어 있는 경우 이미지는 수정하지 않았으므로 텍스트만 처리

| 수정 모달                                                                                                                               | 수정 페이지                                                                                                                               | 수정 결과                                                                                                                               |
| --------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/ba83839e-7b7e-44ea-9595-101bfdb15800" alt="수정 모달" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/85530e19-a3d7-48ff-9061-7d8b28eddd5a" alt="수정 페이지" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/70c06bb9-ee9f-4426-bcc9-58f160161619" alt="수정 결과" width="300"> |

<br />
<br />

### My List

-   북마크와 좋아요 목록을 관리하는 화면입니다.
-   회원가입 시 `기본 그룹`이 자동으로 생성됩니다.
-   그룹별 아이콘과 그룹명을 선택하여 관리할 수 있습니다.

| 첫화면                                                                                                                               | 새그룹 추가                                                                                                                               | 새그룹 추가 결과                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/058e9790-297c-494d-ad78-3a1ab33fa944" alt="첫화면" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/75932715-7cbb-4747-9b3c-35f332024beb" alt="새그룹 추가" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/905ce785-24a4-4edd-9c96-89b862406f80" alt="새그룹 추가 결과" width="300"> |

<br />

-   식당을 북마크하면 기본적으로 `기본 그룹`에 속하게 됩니다.
-   그룹을 이동하려면 식당이 속한 그룹 페이지로 진입한 후 `복사` => `원본삭제` 순서로 이루어집니다.

| 그룹 수정                                                                                                                               | 그룹 내 목록                                                                                                                               | 그룹 이동1                                                                                                                               |
| --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/b3491a80-67c9-4993-8291-ba54513a1b9a" alt="그룹 수정" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/4600a206-48ec-4829-b5e7-47665ce574d5" alt="그룹 내 목록" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/1b876a71-c72e-4b89-a219-07e80d049fe0" alt="그룹 이동1" width="300"> |

| 그룹 이동2                                                                                                                               | 그룹 이동3                                                                                                                               | 그룹 이동 결과                                                                                                                               |
| ---------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/4357c11f-b00d-4880-b380-fec276d648b0" alt="그룹 이동2" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/6e5ad5f8-7fcc-4c67-adf2-2105192f1158" alt="그룹 이동3" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/84d5c08c-1316-4b2b-951a-79614685713b" alt="그룹 이동 결과" width="300"> |

<br />
<br />

### Community

-   로그인 없이 게시판을 읽을 수 있습니다.
-   오늘 게시된 글은 `hh:mm` 형식으로 나타납니다.
-   IntersectionObserver API로 페이지네이션된 데이터의 마지막 데이터를 감시하고 다음 페이지를 요청합니다.

| 첫화면                                                                                                                               | 댓글입력                                                                                                                               | 결과                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/ac285307-4654-474a-9b69-d42756205ae7" alt="첫화면" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/ceb09c4c-e607-4981-8003-229bad4c0ff3" alt="댓글입력" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/b52c0e08-782e-4e65-ad53-9b161f44c37d" alt="결과" width="300"> |

<br />

-   간단한 텍스트 편집이 가능합니다.
-   **(작성완료 시)** raw html 태그를 문자열로 저장
    ```tsx
    {
        ...
        content: `<h1>안내 사항</h1>`
    }
    ```
-   **(읽기)** DOMpurify로 감싼 후 에디터 내부에 주입
    ```tsx
    <TextEditor dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(htmlString) }} />
    ```
-   **(편집 시)** 꾸며진 텍스트를 다시 불러오기 위해 db에 저장되어 있는 raw html 문자열을 draftjs의 contentState로 변환

| 글쓰기                                                                                                                               | 결과                                                                                                                               | 모달                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/d014ebd9-e07d-42f9-b569-29f1348777b0" alt="글쓰기" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/1a7a0ff5-79ca-4cec-adce-88f33ba1cf09" alt="결과" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/1c48adbd-d855-42c2-aa61-77c9a4a6fb56" alt="모달" width="300"> |

| 글 수정                                                                                                                               | 말머리                                                                                                                               | 검색                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/d39b9682-714b-4c08-a4a7-cca35bd61f67" alt="글 수정" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/381122f4-4b92-4732-b805-6343beb0e095" alt="말머리" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/870103e5-0f48-4bfb-ab71-8d6e0b6aa2f1" alt="검색" width="300"> |

<br />
<br />

### My Page

-   프로필 섹션에서 계정 정보를 변경할 수 있습니다.
-   프로필 사진을 삭제하거나 변경할 수 있습니다.
-   닉네임을 변경할 수 있습니다.
    -   정규식 검사 => 중복 검사
-   비밀번호를 변경할 수 있습니다.
    -   기존 비밀번호 일치 검사 => 정규식 검사

| 첫화면                                                                                                                               | 프로필사진 변경                                                                                                                             | 닉네임 변경                                                                                                                               |
| ------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/c2a5effb-13a3-4751-a342-f80293ec5e2f" alt="첫화면" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/98950f25-6f0b-49f7-8013-058ef4431e56" alt="로필사진 변경" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/c89e42da-cbe0-4b31-be09-639554f159ee" alt="닉네임 변경" width="300"> |

<br />

-   리뷰를 남긴 식당 이름과 리뷰를 모아볼 수 있습니다.

| 비밀번호 변경1                                                                                                                               | 비밀번호 변경2                                                                                                                               | 리뷰 모아보기                                                                                                                              |
| -------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f44ad105-7d0f-4c4e-ac70-7dac7f08c527" alt="비밀번호 변경1" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f4b2c11b-3bb4-4153-b7db-9e735ce3567f" alt="비밀번호 변경2" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/5ddb9b0d-648b-424e-9c05-92e886f6f6cd" alt="리뷰모아보기" width="300"> |

<br />
<br />

<!-- <img src="" alt="" width="300"> -->

### Sign Up, Sign In

-   토큰은 2048bit 비밀키를 사용하여 로그인 시 JWT로 발급합니다.
-   회원가입 기능은 인풋별로 값을 검증하는 스테이지 구조의 UI입니다
    e.g 아이디를 통과하지 못하면 닉네임 스테이지로 넘어갈 수 없습니다.

| 회원가입                                                                                                                               | 메시지                                                                                                                               | 로그인                                                                                                                               |
| -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/130538ee-e56d-416e-b180-d529692f43d4" alt="회원가입" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/b8f8f69a-6f19-4cd8-8daa-393f8d570303" alt="메시지" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/f2e092ca-80c4-40e0-851a-83a9e4742db3" alt="로그인" width="300"> |

<br />

-   `로그인 유지` 항목을 체크하면 쿠키 만료기한이 7일로 설정됩니다. 이외에는 세션 토큰이 설정됩니다.
-   카카오 로그인 시 전달받은 `사용자 id`를 `userId`로 등록하고 프로필 사진과 닉네임을 가져옵니다. 최초 로그인 시 userId를 등록하는 회원가입 로직이 실행됩니다.

| 화면전환                                                                                                                               | 카카오 로그인                                                                                                                               | 결과                                                                                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| <img src="https://github.com/moonhee0507/green-maps/assets/102460056/6f4186a8-da0a-42b8-ba81-d2cff036529a" alt="화면전환" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/13612ab6-c22d-4e5e-ab8f-5c17843747db" alt="카카오 로그인" width="300"> | <img src="https://github.com/moonhee0507/green-maps/assets/102460056/a14027fb-7b65-408b-9c8b-3581d6540611" alt="카카오 로그인 결과" width="300"> |

<br />

## Trouble Shooting

-   **서버 배포 후 db의 registeredAt 시간이 실제 시간과 차이나는 현상**
    -   서버 빌드 환경변수에 `TZ=Asia/Seoul` 추가하여 해결
-   **jwt 비대칭키 형식 문제**

    -   올바른 환경변수 형식 사용

        ```ts
        // .env
        PRIVATE_KEY = '-----BEGIN RSA PRIVATE KEY-----\nabcd...\n-----END RSA PRIVATE KEY---';

        // 환경변수 문자열 내부 개행문자를 실제 개행으로 변환
        const privateKey: string = process.env.PRIVATE_KEY.replace(/\\n/g, '\n');
        ```

-   **모바일 웹 100vh 기준 문제 해결**

    -   데스크탑 크롬 웹에서 100vh는 주소창을 제외한 나머지 뷰의 높이지만, 모바일 웹에서는 주소창 포함 높이로 계산됩니다. 그래서 모바일에서는 주소창 높이만큼 밀려서 네비게이션 바가 보이지 않는 현상이 있었습니다.
    -   모바일 환경에서는 높이를 innerHeight로 계산하도록 수정

        ```tsx
        function App({ children }: { children: React.ReactNode }) {
            const [isMobile, setIsMobile] = useState(false);

            const appRef = useRef<HTMLDivElement>(null);

            useEffect(() => {
                setIsMobile(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            }, []);

            useEffect(() => {
                if (isMobile) {
                    const element = appRef.current as HTMLDivElement;
                    if (element !== null) {
                        element.style.height = window.innerHeight + 'px';
                    }
                }
            }, [isMobile]);

            return (
                <div className="app" ref={appRef}>
                    {children}
                </div>
            );
        }
        ```
