import{r as p,j as t}from"../chunks/chunk-0ad0329c.js";import{B as y,A as j,u as T,a as P,b as x}from"../chunks/chunk-f6dd005f.js";import{n as d}from"../chunks/chunk-c949b376.js";import{S as N}from"../chunks/chunk-7deb6bd9.js";import{u as g}from"../chunks/chunk-da345742.js";import{S as b,T as C,P as A,a as E,u as R}from"../chunks/chunk-b82a1d50.js";import{N as I}from"../chunks/chunk-5b1b7faa.js";import"../chunks/chunk-af981888.js";import"../chunks/chunk-4a7b83e5.js";import"../chunks/chunk-dfbf6de9.js";import"../chunks/chunk-3c838518.js";function w(){const[e,s]=p.useState(!1),r=p.useRef(null);function n(){var l;const i=`/community/search/${(l=r.current)==null?void 0:l.value}`;d(i,{keepScrollPosition:!0})}return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"search-bar",children:t.jsx("div",{children:e?t.jsxs("div",{children:[t.jsx("label",{htmlFor:"searchItem",className:"sr-only",children:"Í≤åÏãúÍ∏Ä Í≤ÄÏÉâÌïòÍ∏∞"}),t.jsx("input",{type:"search",id:"searchItem",ref:r,autoFocus:!0})]}):t.jsx("h2",{className:"top-title",children:"Í≤åÏãúÌåê"})})}),t.jsx("button",{type:"button",onClick:()=>e?n():s(!0),"aria-label":"ÏãùÎãπ Í≤ÄÏÉâ Î≤ÑÌäº",children:"üîç"})]})}function v(){return t.jsxs("div",{className:"top-bar search",children:[t.jsx(y,{}),t.jsx(w,{})]})}function $(e){const s=g(i=>i.postSlice.post.TOTAL),r=g(i=>i.postSlice.SUBJECT),[n,o]=p.useState(0);return p.useEffect(()=>{i(r).then(l=>o(l.todayCount));async function i(l){const a=encodeURIComponent(l);return await(await fetch(`${j}/today/${a}`,{headers:{"Content-Type":"application/json"}})).json()}},[e.posts]),t.jsxs("div",{className:"container-newpost-selectbox",children:[t.jsxs("p",{className:"txt-postinfo",children:["ÏÉàÍ∏Ä ",t.jsx("span",{children:n}),"/",s]}),t.jsx(N,{})]})}function U(){const[e,s]=p.useState(null),r=p.useRef(null);p.useEffect(()=>{n().then(o=>{o.total>=1?s(o.lists):s(null)})},[]);async function n(){return await(await fetch(`${j}/subjects/${encodeURIComponent("Í≥µÏßÄÏÇ¨Ìï≠")}`,{headers:{"Cache-Control":"max-age=31536000"}})).json()}return t.jsxs("article",{className:"article-notice",children:[t.jsx("h3",{className:"sr-only",children:"Í≥µÏßÄÏÇ¨Ìï≠"}),e!==null?t.jsx("ul",{className:"ul-notice",ref:r,children:e.map((o,i)=>t.jsx(L,{posts:o},Math.random()))}):null]})}function L({posts:e}){const{_id:s,title:r,registeredAt:n,updatedAt:o}=e;return t.jsx("li",{className:"li-notice",children:t.jsx("a",{href:`/community/${s}`,children:t.jsxs("p",{className:"txt-title",children:[t.jsx("span",{children:"[Í≥µÏßÄÏÇ¨Ìï≠] "}),t.jsx("em",{children:r})]})})})}const S=p.forwardRef(_);function _(e,s){const{_id:r,subject:n,owner:o,title:i,content:l,photo:a,like:c,registeredAt:u,comments:m}=e.postInfo,f=G(l),h="80px";return t.jsx("li",{ref:s,children:t.jsxs("a",{href:`/community/${r}`,style:{width:"100%",display:"flex",padding:"20px"},children:[t.jsxs("dl",{style:{width:`calc(100% - ${a&&a.length>0?h:"0px"})`},children:[t.jsx(b,{subject:n}),t.jsx(C,{title:i}),t.jsx(A,{content:f}),t.jsx(E,{owner:o,like:c,registeredAt:u,comments:m})]}),a&&a.length>0?t.jsx("dd",{children:t.jsx("img",{src:a[0].src,alt:"",style:{width:h,height:h,objectFit:"cover"}})}):null]})})}function G(e){return e.replaceAll(/<[^>]*>/g,"").replaceAll(/&[a-zA-Z0-9]*;/g,"")}function k(e){const{posts:s,limit:r}=e,n=p.useRef(null),o=T(),i=P(),[l,a]=R(()=>{const c=Math.ceil(o.getState().postSlice.post.TOTAL/r);o.getState().postSlice.post.CURRENT_PAGE<c&&i({type:"postSlice/POST_IN_PAGE",TOTAL:o.getState().postSlice.post.TOTAL,CURRENT_PAGE:o.getState().postSlice.post.CURRENT_PAGE+1})});return p.useEffect(()=>{const c=Math.ceil(o.getState().postSlice.post.TOTAL/r),u=o.getState().postSlice.post.CURRENT_PAGE;u===c?(a(n.current),console.log(`currentPageÍ∞Ä ${u}Ïù¥Í≥† lastPageÍ∞Ä ${c}Ïó¨ÏÑú Í∞êÏãú Ï§ëÎã®`)):u<c&&(l(n.current),console.log(`currentPageÍ∞Ä ${u}Ïù¥Í≥† lastPageÍ∞Ä ${c}Ïó¨ÏÑú Í∞êÏãú Í≥ÑÏÜç =======`))},[l,a]),t.jsx("ul",{className:"wrapper-posts",children:s.filter(c=>c.subject!=="Í≥µÏßÄÏÇ¨Ìï≠").map((c,u)=>u===s.length-1?t.jsx(S,{postInfo:c,ref:n},u):t.jsx(S,{postInfo:c},u))})}function B(e){const{posts:s,limit:r}=e;return t.jsxs("section",{children:[t.jsx("h3",{className:"sr-only",children:"Í≤åÏãúÍ∏Ä Î™©Î°ù"}),t.jsx(U,{}),t.jsx(k,{posts:s,limit:r})]})}function O({posts:e,limit:s,isLoggedIn:r}){const n=p.useRef(null),[o,i]=p.useState(!1);function l(){var c;(c=n==null?void 0:n.current)==null||c.scrollTo({top:0,left:0,behavior:"auto"})}function a(){var c;((c=n==null?void 0:n.current)==null?void 0:c.scrollTop)===0?i(!1):i(!0)}return t.jsxs(t.Fragment,{children:[t.jsxs("main",{className:"main-community",ref:n,onScroll:a,children:[t.jsx($,{posts:e}),t.jsx(B,{posts:e,limit:s})]}),o&&t.jsx("button",{id:"buttonGoUp",onClick:l,type:"button",children:"Îß®ÏúÑÎ°ú"})]})}function F({isLoggedIn:e}){function s(){e?d("/community/create"):confirm(`Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.
Î°úÍ∑∏Ïù∏ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)&&d("/login")}return t.jsx("button",{type:"button",className:"link-create",onClick:s,children:"Í∏ÄÏì∞Í∏∞"})}function X(e){var u;const{isLoggedIn:s}=e.user,r=x(m=>m.postSlice.SUBJECT),n=x(m=>m.postSlice.post.CURRENT_PAGE),o=20,[i,l]=p.useState(((u=e.postProps)==null?void 0:u.lists)||[]),a=p.useCallback(async()=>{try{return await(await fetch(`${j}/${r!==""?"subjects/"+r:"posts"}?page=${n}&limit=${o}`,{headers:{"Content-Type":"application/json"}})).json()}catch(m){console.log(m)}},[n,r]),c=P();return p.useEffect(()=>{a().then(m=>{l(m.currentPage===1?m.lists:[...i,...m.lists]),c({type:"postSlice/POST_IN_PAGE",TOTAL:m.total,CURRENT_PAGE:m.currentPage})})},[a]),t.jsxs(t.Fragment,{children:[t.jsx(v,{}),t.jsx(F,{isLoggedIn:s}),t.jsx(O,{posts:i,limit:o,isLoggedIn:s}),t.jsx(I,{isLoggedIn:s})]})}export{X as Page};
