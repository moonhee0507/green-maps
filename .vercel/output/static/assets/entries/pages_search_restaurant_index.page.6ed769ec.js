import{r as o,j as e}from"../chunks/chunk-0ad0329c.js";import{T as b}from"../chunks/chunk-254a5612.js";import"../chunks/chunk-da345742.js";import{a as k,A as h,b as d,c as x}from"../chunks/chunk-f6dd005f.js";import{n as f}from"../chunks/chunk-c949b376.js";import{i as E}from"../chunks/chunk-9ae07e36.js";import{S as g}from"../chunks/chunk-32ec8ef6.js";import{R as C}from"../chunks/chunk-7962c6c8.js";import{P as O}from"../chunks/chunk-10befb9c.js";import{N as L}from"../chunks/chunk-5b1b7faa.js";import{E as j}from"../chunks/chunk-2b326172.js";import"../chunks/chunk-41308c4f.js";import"../chunks/chunk-af981888.js";import"../chunks/chunk-dfbf6de9.js";import"../chunks/chunk-3c838518.js";const T="/images/icon-bookmark.svg";function _({restaurantId:t,isLoggedIn:s}){const r=k(),a=o.useCallback(async()=>{if(s)return(await(await fetch(`${h}/users/`)).json()).user.bookmarkList.some(u=>t===u._id)},[t,s]),n=o.useCallback(async()=>{s&&((await fetch(`${h}/users/bookmark/${t}`,{method:"DELETE"})).ok?r({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:!1}):console.error("Î∂ÅÎßàÌÅ¨ Ï∑®ÏÜåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§."))},[t,s]);o.useEffect(()=>{a().then(i=>{r({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:i})})},[a,s]);function l(){s?a().then(i=>i?n():c()):confirm(`Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.
Î°úÍ∑∏Ïù∏ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)&&f("/login")}async function c(){try{if((await fetch(`${h}/users/bookmark`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:t})})).ok)r({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:!0});else throw new Error}catch(i){console.error(i)}}return e.jsxs("button",{className:"button-bookmark",onClick:l,type:"button",children:[e.jsx("img",{src:T,alt:"Î∂ÅÎßàÌÅ¨ Ïù¥ÎØ∏ÏßÄ",className:d(i=>i.buttonSlice.bookmark.ON?"img-bookmark on":"img-bookmark")}),e.jsx("span",{className:"txt-bookmark",children:"Î∂ÅÎßàÌÅ¨"})]})}function $({restaurantId:t,isLoggedIn:s}){const r=k(),a=o.useCallback(async()=>{if(s)return(await(await fetch(`${h}/users/`)).json()).user.likeList.some(u=>t===u._id)},[t,s]),n=o.useCallback(async()=>{(await fetch(`${h}/users/like/${t}`,{method:"DELETE"})).ok?r({type:"buttonSlice/HAS_LIKE_LIST",ON:!1}):console.error("Ï¢ãÏïÑÏöî Ï∑®ÏÜåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.")},[t,s]);o.useEffect(()=>{a().then(i=>{r({type:"buttonSlice/HAS_LIKE_LIST",ON:i})})},[a,s]);function l(){s?a().then(i=>i?n():c()):confirm(`Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.
Î°úÍ∑∏Ïù∏ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)&&f("/login")}async function c(){try{if((await fetch(`${h}/users/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:t})})).ok)r({type:"buttonSlice/HAS_LIKE_LIST",ON:!0});else throw new Error}catch(i){console.error(i)}}return e.jsxs("button",{className:"button-like",onClick:l,type:"button",children:[e.jsx("img",{src:E,alt:"Ï¢ãÏïÑÏöî Ïù¥ÎØ∏ÏßÄ",className:d(i=>i.buttonSlice.like.ON?"img-like on":"img-like")}),e.jsx("span",{className:"txt-like",children:"Ï¢ãÏïÑÏöî"})]})}const R="/images/icon-share.svg";function B(){return e.jsxs("button",{className:"button-share",onClick:()=>console.log("Í≥µÏú†ÌïòÍ∏∞"),type:"button",children:[e.jsx("img",{src:R,alt:"Í≥µÏú†ÌïòÍ∏∞ Ïù¥ÎØ∏ÏßÄ",className:"img-share"}),e.jsx("span",{className:"txt-share",children:"Í≥µÏú†ÌïòÍ∏∞"})]})}function A({restaurantId:t,isLoggedIn:s}){return e.jsxs("div",{className:"container-bookmark-like-share",children:[e.jsx(_,{restaurantId:t,isLoggedIn:s}),e.jsx($,{restaurantId:t,isLoggedIn:s}),e.jsx(B,{})]})}const D="/images/icon-copy.svg";function w(t){const s=()=>{window.navigator.clipboard.writeText(t.address),alert("Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.")};return e.jsxs("button",{type:"button",onClick:s,children:[e.jsx("img",{src:D,alt:"Ï£ºÏÜå Î≥µÏÇ¨ ÏïÑÏù¥ÏΩò",className:"img-copy"}),e.jsx("span",{style:{fontSize:"13px"},children:"Î≥µÏÇ¨"})]})}function P(t){return e.jsxs("div",{children:[t.cert?e.jsx("div",{className:"restaurant-cert",children:t.cert}):null,e.jsx("div",{className:"restaurant-category",children:t.category}),e.jsx("h3",{className:"txt-restaurant-title",children:t.title}),e.jsxs("div",{children:[e.jsxs("span",{className:"txt-restaurant-address",children:[t.address," "]}),e.jsx(w,{address:t.address})]})]})}function M({restaurantInfo:t,isLoggedIn:s}){const{_id:r,title:a,address:n,category:l,rating:c,certification:i}=t,p=typeof i=="string";let u={title:a,address:n,category:l};return p&&(u={...u,cert:i}),e.jsxs("section",{className:"section-primary",children:[e.jsx(P,{...u}),e.jsx(g,{rating:c}),e.jsx(A,{restaurantId:r,isLoggedIn:s})]})}function K({restaurantInfo:t}){return o.useEffect(()=>{const{kakao:s}=window,[r,a]=t.location.coordinates,n=document.getElementById("miniMap"),l={center:new s.maps.LatLng(a,r),level:3},c=new s.maps.Map(n,l);var i=new s.maps.Marker({position:new s.maps.LatLng(a,r)});i.setMap(c)},[]),e.jsxs("section",{className:"section-location",children:[e.jsx("h4",{className:"sr-only",children:"ÏúÑÏπò"}),e.jsxs("div",{className:"style-wrapper-location-address",children:[e.jsxs("span",{children:[t.address," "]}),e.jsx(w,{address:t.address})]}),e.jsx("div",{id:"miniMap"})]})}function H({restaurantId:t,isLoggedIn:s}){function r(){s?f(`/search/${t}/reviews/create`):confirm(`Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.
Î°úÍ∑∏Ïù∏ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)&&f("/login")}return e.jsx("div",{className:"style-container-write-review",children:e.jsx("button",{type:"button",onClick:r,className:"styled-button",children:"Î¶¨Î∑∞ ÏûëÏÑ±ÌïòÍ∏∞"})})}function I({reviews:t,userInfo:s,restaurantId:r}){return e.jsx("div",{className:"wrapper-review",children:t&&t.length>0?e.jsx("ul",{children:t.map((a,n)=>e.jsx(C,{item:a,userInfo:s,restaurantId:r,isFirst:n===0},n))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"üò≠"}),e.jsx("p",{children:"Î¶¨Î∑∞Í∞Ä ÏïÑÏßÅ ÏóÜÏñ¥Ïöî."})]})})}function F({restaurantInfo:t,isLoggedIn:s,userInfo:r}){const{_id:a,reviews:n}=t,l=x(),c=d(m=>m.paginationSlice.currentPage),[i,p]=o.useState(0),[u,y]=o.useState(null);o.useEffect(()=>{l({type:"paginationSlice/CURRENT_PAGE",currentPage:1})},[t]);const v=o.useCallback(async()=>await(await fetch(`${h}/restaurants/${a}/reviews`)).json(),[t]),S=o.useCallback(async()=>await(await fetch(`${h}/restaurants/${a}?page=${c}`)).json(),[c]);return o.useEffect(()=>{v().then(m=>{m.success&&p(m.reviews.total)}),S().then(m=>{m.success&&y(m.restaurantInfo.reviews)})},[t,c]),e.jsxs("section",{className:"section-review",children:[e.jsx("h4",{className:"sr-only",children:"Î¶¨Î∑∞"}),e.jsx(H,{restaurantId:a,isLoggedIn:s}),e.jsx(I,{reviews:u,userInfo:r,restaurantId:a}),n&&n.length>0&&e.jsx(O,{count:i,perPage:5})]})}function U({restaurantInfo:t,isLoggedIn:s,userInfo:r}){return e.jsxs("main",{className:"wrapper-restaurant-detail",children:[e.jsx(M,{restaurantInfo:t,isLoggedIn:s}),e.jsx(K,{restaurantInfo:t}),e.jsx(F,{restaurantInfo:t,isLoggedIn:s,userInfo:r})]})}function q(){const[t,s]=o.useState(!1),r=d(n=>n.reviewSlice.editDeleteNotifyModalOn),a=d(n=>n.reviewSlice.sameUserOwner);return o.useEffect(()=>{s(r===!0)},[r]),e.jsxs("article",{className:`modal-edit-delete-notify ${t?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"ÏàòÏ†ï, ÏÇ≠Ï†ú, Ïã†Í≥†Ïö© Î™®Îã¨"}),e.jsx("ul",{children:a?e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(G,{})]}):e.jsx("li",{children:" üö® Ïã†Í≥†ÌïòÍ∏∞"})})]})}function J(){const t=x(),s=d(n=>n.reviewSlice.reviewId),r=d(n=>n.reviewSlice.restaurantId);function a(){f(`/search/${r}/reviews/${s}/edit`);const n=document.querySelector(".app");n==null||n.classList.remove("modal-mode"),t(j(!1))}return e.jsx("li",{onClick:a,children:"ü©π ÏàòÏ†ïÌïòÍ∏∞"})}function G(){const t=x(),s=d(n=>n.reviewSlice.reviewId),r=d(n=>n.reviewSlice.restaurantId);async function a(){try{(await(await fetch(`${h}/reviews/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({restaurantId:r})})).json()).success?f(`/search/${r}`):alert("Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.")}catch(n){console.error(n)}finally{const n=document.querySelector(".app");n==null||n.classList.remove("modal-mode"),t(j(!1))}}return e.jsx("li",{onClick:a,children:"üóëÔ∏è ÏÇ≠Ï†úÌïòÍ∏∞"})}function z(){const t=d(l=>l.reviewSlice.editDeleteNotifyModalOn),[s,r]=o.useState(!1),a=x();o.useEffect(()=>{r(t===!0)},[t]),o.useEffect(()=>(s&&document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}),[s]);function n(l){if(l.target.className==="app modal-mode"){const c=document.querySelector(".app");c==null||c.classList.remove("modal-mode"),a(j(!1))}}return e.jsx("div",{className:`modal-group ${s?"on":""}`,children:e.jsx(q,{})})}function le(t){const{restaurantInfo:s,user:r}=t,{isLoggedIn:a,info:n}=r;return e.jsxs(e.Fragment,{children:[e.jsx(b,{title:"ÏÉÅÏÑ∏Ï†ïÎ≥¥"}),e.jsx(U,{restaurantInfo:s,isLoggedIn:a,userInfo:n}),e.jsx(L,{isLoggedIn:a}),e.jsx(z,{})]})}export{le as Page};
