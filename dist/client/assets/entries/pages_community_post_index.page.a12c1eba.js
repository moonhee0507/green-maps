import{j as e,r as l,R as _}from"../chunks/chunk-0ad0329c.js";import{A as f,b as x,u}from"../chunks/chunk-f5cf074f.js";import{S as $}from"../chunks/chunk-f3107ac8.js";import{T as M}from"../chunks/chunk-fa93ea2c.js";import{D as O}from"../chunks/chunk-4a7b83e5.js";import{i as P}from"../chunks/chunk-9ae07e36.js";import{i as b}from"../chunks/chunk-dfbf6de9.js";import{a as p,S as I,b as w,c as L,d as D,e as v}from"../chunks/chunk-41308c4f.js";import{a as E}from"../chunks/chunk-3258e6a6.js";import{P as A}from"../chunks/chunk-8275f212.js";import{u as R}from"../chunks/chunk-80567fa3.js";import{L as T}from"../chunks/chunk-857879ef.js";import"../chunks/chunk-da345742.js";import"../chunks/chunk-1de3b966.js";function B(n){const s=n.content;return typeof window<"u"?e.jsx("div",{dangerouslySetInnerHTML:{__html:O.sanitize(s)},style:{wordBreak:"keep-all",marginTop:"40px"}}):e.jsx("div",{style:{wordBreak:"keep-all",marginTop:"40px"}})}function U(n){const{postId:s,like:c}=n,[o,t]=l.useState(null),[a,r]=l.useState(c?c.length:0),[i,d]=l.useState(!1);l.useEffect(()=>{h();async function h(){try{const y=await(await fetch(`${f}/users`)).json();y.success?t(y.user.userId):t(null)}catch(j){console.error(j)}}},[]),l.useEffect(()=>{c&&d(c.some(h=>h.user===o))},[o]);function m(){i?S():g(),d(!i)}async function g(){if((await fetch(`${f}/posts/${s}/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)r(a+1);else throw new Error}async function S(){if((await fetch(`${f}/posts/${s}/like`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)r(a-1);else throw new Error}return e.jsxs("button",{className:"button-like",type:"button",onClick:m,style:{margin:"60px auto 0px"},children:[e.jsx("img",{src:P,alt:"좋아요 이미지",className:`img-like review ${i?"on":""}`}),e.jsx("span",{style:{minWidth:"20px"},children:a})]})}function F({userInfo:n,owner:s,postId:c}){const o=x(),t=l.useRef(null),[a,r]=l.useState(null);l.useEffect(()=>{n!==null&&r(n)},[n]);function i(){E(!0),o(p(!0)),o(I((a==null?void 0:a.nickName)===s)),o(w(c)),o(L("post"))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more postitem",onClick:i,ref:t})}function G({userInfo:n,postInfo:s}){const{subject:c,content:o,like:t,owner:a,photo:r,registeredAt:i,comments:d,title:m,_id:g}=s;return e.jsxs("section",{className:"section-post-content",children:[e.jsx("h3",{"aria-label":"게시글 제목",className:"txt-post-title",children:m}),e.jsxs("div",{children:[e.jsx("p",{"aria-label":"작성자",className:"txt-post-owner",children:a}),e.jsxs("div",{className:"container-post-subinfo",children:[e.jsx(J,{like:t}),e.jsx(W,{comments:d}),e.jsx(q,{registeredAt:i})]})]}),e.jsx(B,{content:o}),e.jsx(U,{postId:g,like:t}),e.jsx(F,{userInfo:n,owner:a,postId:g})]})}function J(n){var s;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"좋아요 개수"}),e.jsx("dd",{className:"container-count-like",children:e.jsx("span",{children:((s=n.like)==null?void 0:s.length)||0})})]})}function W(n){var s;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"댓글 개수"}),e.jsx("dd",{className:"container-count-comment",children:e.jsx("span",{children:((s=n.comments)==null?void 0:s.length)||0})})]})}function q(n){var o,t;const{registeredAt:s}=n,c=b(s)?`${(o=s.split(". ").at(-1))==null?void 0:o.split(":")[0]}:${(t=s.split(". ").at(-1))==null?void 0:t.split(":")[1]}`:s.slice(0,13);return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"작성 시간"}),e.jsx("dd",{className:"container-post-time",children:e.jsx("time",{dateTime:"",children:c})})]})}function H(n){const{postId:s,content:c}=n;async function o(){return await(await fetch(`${f}/users/`,{credentials:"include",method:"GET"})).json()}function t(){o().then(r=>{r.success===!0?a(r.user.nickName):confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")})}async function a(r){try{if(c!==null&&c.length>0){const i={owner:r,content:c};(await(await fetch(`${f}/posts/${s}/comment`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json()).success===!0&&window.location.reload()}}catch(i){console.error(i)}}return e.jsx("button",{type:"button",onClick:t,disabled:!(c!==null&&c.length>0),"aria-label":"댓글 등록 버튼"})}function V({postId:n}){const[s,c]=l.useState(null);function o(t){c(t.target.value)}return e.jsxs("form",{className:"form-create-comment",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글 작성하기"}),e.jsx("textarea",{id:"comment",onChange:o,minLength:1,maxLength:100}),e.jsx(H,{postId:n,content:s})]})}function z(){return e.jsx("div",{className:"container-notice comment",children:e.jsx("em",{children:"게시글과 관련없는 홍보성 댓글과 저속한 표현의 비방성 댓글은 삭제될 수 있습니다."})})}function Y({userInfo:n,postId:s,comment:c}){const o=x(),t=l.useRef(null),[a,r]=l.useState(null);l.useEffect(()=>{n!==null&&r(n)},[n]);function i(){const d=document.querySelector(".app");d==null||d.classList.add("modal-mode"),o(p(!0)),o(I((a==null?void 0:a.nickName)===c.owner)),o(L("comment")),o(w(s)),o(D(c._id))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more commentitem",onClick:i,ref:t})}function K({userInfo:n,postId:s,comments:c}){return c&&c.length>0?e.jsx("ul",{children:c.map((o,t)=>e.jsx(Q,{userInfo:n,postId:s,comment:o,isLast:t===c.length-1},o._id))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"댓글이 없어요."})]})}function Q({userInfo:n,postId:s,comment:c,isLast:o}){var y,C;const t=u(N=>N.postSlice.commentId),{_id:a,owner:r,content:i,like:d,registeredAt:m,updatedAt:g}=c,S=u(N=>N.postSlice.editCommentMode),h=b(m)?`${(y=m.split(". ").at(-1))==null?void 0:y.split(":")[0]}:${(C=m.split(". ").at(-1))==null?void 0:C.split(":")[1]}`:m.slice(0,13),j=l.useRef(null);return l.useEffect(()=>{o&&j.current&&j.current.scrollIntoView(!1)},[o]),e.jsxs("li",{className:"li-commentitem",ref:j,children:[e.jsxs("dl",{className:"wrapper-commentitem",children:[e.jsxs("dl",{className:"container-owner-date",children:[e.jsx("dt",{className:"sr-only",children:"댓글 작성자"}),e.jsx("dd",{className:"txt-owner",children:r}),e.jsx("dt",{className:"sr-only",children:"게시 시간"}),e.jsx("dd",{className:"txt-date",children:h})]}),e.jsxs("dl",{children:[e.jsx("dt",{className:"sr-only",children:"댓글 내용"}),S&&t===a?e.jsx(X,{content:i}):e.jsx("dd",{className:"txt-content",children:i})]})]}),S&&t===a?e.jsx(Z,{postId:s,commentId:c._id}):e.jsx(Y,{userInfo:n,postId:s,comment:c})]})}function X({content:n}){const[s,c]=l.useState(n);function o(t){c(t.target.value)}return e.jsx("textarea",{id:"editCommentTextarea",onChange:o,minLength:1,maxLength:100,value:s})}function Z({postId:n,commentId:s}){function c(){const t=document.getElementById("editCommentTextarea");t!==null&&o(t.value)}async function o(t){(await(await fetch(`${f}/comments/${s}?postId=${n}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})})).json()).success?alert("댓글이 수정되었습니다."):alert("다시 시도해주세요."),window.location.reload()}return e.jsx("button",{type:"button",className:"button-more commentitem edit",onClick:c,children:"수정"})}const k=10;function ee({postId:n,comments:s,userInfo:c}){const o=x(),t=u(d=>d.paginationSlice.comment),a=u(d=>d.paginationSlice.currentPage),[r,i]=l.useState(t[a-1]);return l.useEffect(()=>{o({type:"paginationSlice/CURRENT_PAGE",currentPage:Object.keys(t).length})},[t]),l.useEffect(()=>{i(t[a-1])},[t,a]),e.jsxs("section",{className:"section-post-comment",children:[s&&s.length>0?e.jsxs("h3",{children:["댓글 ",e.jsxs("span",{children:["(",s.length,")"]})]}):e.jsx("h3",{className:"sr-only",children:"댓글"}),e.jsx(z,{}),e.jsx(V,{postId:n}),e.jsx(K,{postId:n,comments:r,userInfo:c}),s&&s.length>k?e.jsx(A,{count:s.length,perPage:k}):null]})}function te(){const[n,s]=l.useState(!1),c=u(t=>t.postSlice.editDeleteNotifyModalOn),o=u(t=>t.postSlice.sameUserOwner);return l.useEffect(()=>{s(c===!0)},[c]),e.jsxs("article",{className:`modal-edit-delete-notify ${n?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:o?e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(ne,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function se(){const n=x(),s=u(t=>t.postSlice.postId),c=u(t=>t.postSlice.accessTarget);function o(){c==="post"?(window.location.href=`/community/edit/${s}`,E(!1),n(p(!1))):c==="comment"&&(n(v(!0)),E(!1),n(p(!1)))}return e.jsx("li",{onClick:o,children:"🩹 수정하기"})}function ne(){const n=x(),s=u(i=>i.postSlice.postId),c=u(i=>i.postSlice.commentId),o=u(i=>i.postSlice.accessTarget);async function t(){o==="post"?a():o==="comment"&&r()}async function a(){try{(await(await fetch(`${f}/posts/${s}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.href="/community":alert("다시 시도해주세요.")}catch(i){console.error(i)}finally{E(!1),n(p(!1))}}async function r(){try{(await(await fetch(`${f}/comments/${c}?postId=${s}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.reload():alert("다시 시도해주세요.")}catch(i){console.error(i)}finally{E(!1),n(p(!1))}}return e.jsx("li",{onClick:t,children:"🗑️ 삭제하기"})}function oe(){const n=u(a=>a.postSlice.editDeleteNotifyModalOn),[s,c]=l.useState(!1),o=x();l.useEffect(()=>{c(n===!0)},[n]),l.useEffect(()=>(s&&document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[s]);function t(a){if(a.target.className==="app modal-mode"){const r=document.querySelector(".app");r==null||r.classList.remove("modal-mode"),o(p(!1)),o(w(""))}}return e.jsx("div",{className:`modal-group ${s?"on":""}`,children:e.jsx(te,{})})}const ye={title:"게시글 | Green Maps",description:"채식 식당 지도 서비스 게시글 페이지"};function Ee(n){const s=x(),[c,o]=R(),[t,a]=l.useState(()=>n.post?n.post:null);return l.useEffect(()=>{if(t&&t.comments){const r={};for(let i=0;i<t.comments.length;i=i+10){const d=t.comments.slice(i,i+10);r[i/10]=d}s($(r))}},[t]),t?e.jsxs(_.Suspense,{fallback:e.jsx(T,{}),children:[e.jsx(M,{title:t.subject}),e.jsxs("main",{className:"main-read-post",children:[e.jsx(G,{userInfo:o,postInfo:t}),t.subject!=="공지사항"&&e.jsx(ee,{userInfo:o,postId:t._id,comments:t.comments})]}),e.jsx(oe,{})]}):e.jsx(T,{})}export{Ee as Page,ye as documentProps};
//# sourceMappingURL=pages_community_post_index.page.a12c1eba.js.map
