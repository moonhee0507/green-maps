import{_ as M}from"../chunks/chunk-101896b7.js";import{r as c,j as e,R as P}from"../chunks/chunk-0ad0329c.js";import{T as D}from"../chunks/chunk-8eee58da.js";import{N as L}from"../chunks/chunk-5b1b7faa.js";import{b as p,A as h,u as m}from"../chunks/chunk-ee696397.js";import{P as w,E as v,a as T,S as _,b as E,c as S,d as b}from"../chunks/chunk-91c16fc8.js";import{r as $}from"../chunks/chunk-c8344d66.js";import{i as C}from"../chunks/chunk-e8bc0b58.js";import{v as A}from"../chunks/chunk-9bdd667e.js";import{n as I}from"../chunks/chunk-54587732.js";import{E as k,S as R,a as F,b as U}from"../chunks/chunk-2b326172.js";import{u as V}from"../chunks/chunk-b60bc363.js";import{L as O}from"../chunks/chunk-c9eff144.js";import"../chunks/chunk-02d17786.js";import"../chunks/chunk-41308c4f.js";import"../chunks/chunk-3c838518.js";import"../chunks/chunk-4ee9bcfe.js";import"../chunks/chunk-0249643f.js";function re(){import.meta.url,import("_").catch(()=>1);async function*o(){}}function q(){const o=p(),a=c.useRef(null),r=()=>{var i;(i=a.current)==null||i.click()},n=i=>{const l=i.target;if(l.files!==null){const f=l.files[0],y=$()+"."+f.type.replace("image/","");t(f,y)}};async function t(i,l){try{const f={name:`client/${l}`,type:i.type},j=(await(await fetch(`${h}/images/client`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).json()).signedUrl;(await fetch(j,{method:"PUT",headers:{"Content-Type":i.type},body:i})).ok&&await s(l)}catch(f){console.error(f)}}async function s(i){try{await fetch(`${h}/users/edit/profile`,{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileImage:`client/${i}`})})}catch(l){console.error(l)}finally{o(w(!1)),window.location.reload()}}return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"fileInput",accept:"image/*",ref:a,onChange:n,style:{display:"none"}}),e.jsx("button",{type:"button",className:"button-groupname-order on",onClick:r,children:"변경"})]})}function J(){const o=p(),a=async()=>{try{await fetch(`${h}/users/edit/profile`,{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileImage:""})})}catch(r){console.error(r)}finally{o(w(!1)),window.location.reload()}};return e.jsx("button",{type:"button",className:"button-groupname-order on",onClick:a,children:"삭제"})}function W(){const o=m(s=>s.profileSlice.profileImageModalOn),[a,r]=c.useState(!1),n=p();c.useEffect(()=>{r(o===!0)},[o]);function t(){const s=document.querySelector(".app");s==null||s.classList.remove("modal-mode"),n(w(!1))}return e.jsxs("article",{className:`modal-group-item ${a?"on":""}`,children:[e.jsx("h4",{children:"프로필 사진"}),e.jsxs("div",{className:"container-button",children:[e.jsx(q,{}),e.jsx(J,{})]}),e.jsx("button",{type:"button",className:"button-close",onClick:t,children:e.jsx("img",{src:C,alt:"X 아이콘",className:"img-close"})})]})}function B(){const o=p(),[a,r]=c.useState(""),n=m(s=>s.profileSlice.prevNickName);c.useEffect(()=>{r(n)},[n]);const t=s=>{const i=s.target;r(i.value),o(v(i.value))};return e.jsxs("form",{className:"form-edit-nickName",onSubmit:s=>{s.preventDefault()},children:[e.jsxs("p",{className:"num-count-nickName",children:[e.jsx("span",{children:a.length}),"/",e.jsx("span",{children:"17"})]}),e.jsx("label",{htmlFor:"editNickNameInput",className:"sr-only",children:"닉네임"}),e.jsx("input",{type:"text",id:"editNickNameInput",onChange:t,value:a,minLength:1,maxLength:17})]})}function G(){return e.jsx("div",{className:"container-notice edit-nickName",children:e.jsx("em",{children:"한글, 영문, 숫자만 입력가능합니다."})})}function z(o){return o.trim().length===0}function H(){const o=m(d=>d.profileSlice.prevNickName),a=m(d=>d.profileSlice.nextNickName),[r,n]=c.useState(!0),[t,s]=c.useState(!1),[i,l]=c.useState(!0);c.useEffect(()=>{f(a),y(a)},[a]),c.useEffect(()=>{l(o!==a?!(r===!1&&t===!0):!0)},[r,t]);async function f(d){const u=await(await fetch(`${h}/users/check-nickname?nickname=${d}`,{credentials:"include",method:"GET"})).json();return n(u.duplicated),u}function y(d){/^[ㄱ-힣a-zA-Z0-9\s]{1,17}$/g.test(d)&&!z(d)?s(!0):s(!1)}const N=()=>{let d=a.trim();f(d).then(x=>{x.duplicated===!0?alert("닉네임 양옆 띄어쓰기를 제외하고 입력해주세요."):j(d)})};async function j(d){try{(await(await fetch(`${h}/users/edit/profile`,{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:d})})).json()).success&&window.location.reload()}catch(x){console.error(x)}}return e.jsx("button",{type:"button",className:"styled-button nickName",disabled:i,onClick:N,children:(()=>r?"이미 존재하는 닉네임입니다.":t?"완료":"올바른 닉네임을 입력하세요.")()})}function K(){const o=p(),a=m(s=>s.profileSlice.profileNickNameModalOn),[r,n]=c.useState(!1);c.useEffect(()=>{n(a===!0)},[a]);function t(){const s=document.querySelector(".app");s==null||s.classList.remove("modal-mode"),o(T(!1)),o(_("")),o(v(""))}return e.jsxs("article",{className:`modal-group-item ${r?"on":""}`,children:[e.jsx("h4",{children:"닉네임 변경"}),e.jsx(B,{}),e.jsx(G,{}),e.jsx(H,{}),e.jsx("button",{type:"button",className:"button-close",onClick:t,children:e.jsx("img",{src:C,alt:"X 아이콘",className:"img-close"})})]})}function X(){const o=p(),[a,r]=c.useState(!0),[n,t]=c.useState(""),[s,i]=c.useState(""),[l,f]=c.useState(!1),[y,N]=c.useState(!1);c.useEffect(()=>{n===s?(f(!0),A(n)?N(!0):N(!1)):(f(!1),N(!1))},[n,s]),c.useEffect(()=>{r(!(l&&y))},[l,y]);const j=u=>{const g=u.target;t(g.value)},d=u=>{const g=u.target;i(g.value)},x=async()=>{try{(await(await fetch(`${h}/users/edit/password`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:n})})).json()).success&&(await(await fetch(`${h}/users/logout`,{credentials:"include",method:"POST"})).json()).success?(alert(`비밀번호가 변경되었습니다.
로그인 페이지로 이동합니다.`),I("/login")):alert("다시 시도해주세요.")}catch(u){console.error(u)}finally{o(E(!1)),o(S(!1)),o(b(""));const u=document.querySelector(".app");u==null||u.classList.remove("modal-mode")}};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:u=>u.preventDefault(),className:"form-new-password",children:[e.jsx("p",{className:"txt-notice",children:"새로운 비밀번호를 입력해주세요."}),e.jsx("div",{className:"container-notice password",children:e.jsx("em",{children:"영문, 숫자, 특수문자(!@#$%^&*-+_=?) 모두 조합(8자리 이상)"})}),e.jsx("label",{htmlFor:"nextPassword",className:"sr-only",children:"비밀번호"}),e.jsx("input",{type:"password",id:"nextPassword",onChange:j,placeholder:"비밀번호"}),e.jsx("label",{htmlFor:"confirmNextPassword",className:"sr-only",children:"비밀번호 재입력"}),e.jsx("input",{type:"password",id:"confirmNextPassword",onChange:d,placeholder:"비밀번호 재입력",minLength:8,maxLength:32})]}),e.jsx("button",{type:"button",onClick:x,disabled:a,className:"styled-button thin",children:(()=>l?y?"완료":"비밀번호 구성을 확인해주세요.":"두 비밀번호가 일치하지 않습니다.")()})]})}function Y(){const o=p(),a=m(l=>l.profileSlice.userId),r=c.useRef(null),[n,t]=c.useState(""),s=l=>{const f=l.target;t(f.value)},i=async()=>{(await(await fetch(`${h}/users/check-password`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:n})})).json()).success?o(S(!0)):(o(S(!1)),alert("틀린 비밀번호입니다."))};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:l=>l.preventDefault(),className:"form-current-password",children:[e.jsx("p",{className:"txt-notice",children:"그린맵 계정의 현재 비밀번호를 확인해주세요."}),e.jsx("label",{htmlFor:"readOnlyUserId",className:"sr-only",children:"아이디"}),e.jsx("input",{type:"text",id:"readOnlyUserId",readOnly:!0,defaultValue:a,className:"input-userid-in-profile"}),e.jsx("label",{htmlFor:"prevPassword",className:"sr-only",children:"현재 비밀번호"}),e.jsx("input",{type:"password",id:"prevPassword",onChange:s,ref:r,value:n})]}),e.jsx("button",{type:"button",onClick:i,className:"styled-button thin",children:"완료"})]})}function Z(){const o=p(),[a,r]=c.useState(!1),n=m(i=>i.profileSlice.profilePasswordModalOn),t=m(i=>i.profileSlice.passCurrentPassword);c.useEffect(()=>{r(n===!0)},[n]);function s(){const i=document.querySelector(".app");i==null||i.classList.remove("modal-mode"),o(E(!1)),o(S(!1)),o(b(""))}return e.jsxs("article",{className:`modal-group-item ${a?"on":""}`,children:[e.jsx("h4",{children:"비밀번호 재설정"}),t?e.jsx(X,{}):e.jsx(Y,{}),e.jsx("button",{type:"button",className:"button-close",onClick:s,children:e.jsx("img",{src:C,alt:"X 아이콘",className:"img-close"})})]})}function Q(){const[o,a]=c.useState(!1),r=m(t=>t.reviewSlice.editDeleteNotifyModalOn),n=m(t=>t.reviewSlice.sameUserOwner);return c.useEffect(()=>{a(r===!0)},[r]),e.jsxs("article",{className:`modal-edit-delete-notify ${o?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:n?e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(te,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function ee(){const o=p(),a=m(t=>t.reviewSlice.reviewId),r=m(t=>t.reviewSlice.restaurantId);function n(){I(`/search/${r}/reviews/${a}/edit`);const t=document.querySelector(".app");t==null||t.classList.remove("modal-mode"),o(k(!1))}return e.jsx("li",{onClick:n,children:"🩹 수정하기"})}function te(){const o=p(),a=m(t=>t.reviewSlice.reviewId),r=m(t=>t.reviewSlice.restaurantId);async function n(){try{(await(await fetch(`${h}/reviews/${a}`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({restaurantId:r})})).json()).success?I(`/search/${r}`):alert("다시 시도해주세요.")}catch(t){console.error(t)}finally{const t=document.querySelector(".app");t==null||t.classList.remove("modal-mode"),o(k(!1))}}return e.jsx("li",{onClick:n,children:"🗑️ 삭제하기"})}function se(){const o=m(s=>s.profileSlice.profileImageModalOn||s.profileSlice.profileNickNameModalOn||s.profileSlice.profilePasswordModalOn||s.reviewSlice.editDeleteNotifyModalOn),[a,r]=c.useState(!1),n=p();c.useEffect(()=>{r(o===!0)},[o]),c.useEffect(()=>(a&&document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[a]);function t(s){if(s.target.className==="app modal-mode"){const i=document.querySelector(".app");i==null||i.classList.remove("modal-mode"),n(w(!1)),n(T(!1)),n(_("")),n(v("")),n(E(!1)),n(S(!1)),n(b("")),n(k(!1)),n(R(!1)),n(F("")),n(U(""))}}return e.jsxs("div",{className:`modal-group ${a?"on":""}`,children:[e.jsx(W,{}),e.jsx(K,{}),e.jsx(Z,{}),e.jsx(Q,{})]})}const be={title:"내 정보 | Green Maps",description:"채식 식당 지도 서비스 마이 페이지"},ne=P.lazy(()=>M(()=>import("../chunks/chunk-e3e6e3dc.js"),["assets/chunks/chunk-e3e6e3dc.js","assets/chunks/chunk-0ad0329c.js","assets/chunks/chunk-ee696397.js","assets/chunks/chunk-02d17786.js","assets/chunks/chunk-91c16fc8.js","assets/chunks/chunk-41308c4f.js","assets/chunks/chunk-3258e6a6.js","assets/chunks/chunk-14df68f3.js","assets/chunks/chunk-dfbf6de9.js","assets/chunks/chunk-9ae07e36.js","assets/chunks/chunk-2b326172.js","assets/chunks/chunk-15751d2d.js","assets/chunks/chunk-744bc730.js","assets/chunks/chunk-716ac8a7.js"]));function Ce(){const[o,a]=V(),[r,n]=c.useState([]);c.useEffect(()=>{try{a!==null&&t(a).then(s=>{s.success?n(s.reviews):n([])})}catch(s){console.error(s)}},[a]);async function t(s){return await(await fetch(`${h}/reviews/my?owner=${s.userId}`)).json()}return o&&a?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"내 정보"}),e.jsx(P.Suspense,{fallback:e.jsx(O,{}),children:e.jsx(ne,{userInfo:a,reviews:r})}),e.jsx(L,{isLoggedIn:o}),e.jsx(se,{})]}):e.jsx(O,{})}export{Ce as Page,re as __vite_legacy_guard,be as documentProps};
