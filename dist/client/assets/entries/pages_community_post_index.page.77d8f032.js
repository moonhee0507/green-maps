import{j as e,r,R as $}from"../chunks/chunk-0ad0329c.js";import{A as p,b as y,u}from"../chunks/chunk-d2d2d07e.js";import{S as O}from"../chunks/chunk-f3107ac8.js";import{T as _}from"../chunks/chunk-779dc23a.js";import{D as M}from"../chunks/chunk-4a7b83e5.js";import{i as D}from"../chunks/chunk-9ae07e36.js";import{i as k}from"../chunks/chunk-dfbf6de9.js";import{a as g,S as T,b as C,c as b,d as v,e as P}from"../chunks/chunk-41308c4f.js";import{a as N}from"../chunks/chunk-3258e6a6.js";import{P as A}from"../chunks/chunk-d6156fe6.js";import{n as I}from"../chunks/chunk-621f058a.js";import{u as R}from"../chunks/chunk-88a771bc.js";import{L as B}from"../chunks/chunk-6830f513.js";import"../chunks/chunk-533262d2.js";import"../chunks/chunk-bf08ca9a.js";function U(n){const t=n.content;return e.jsx("div",{dangerouslySetInnerHTML:{__html:M.sanitize(t)},style:{wordBreak:"keep-all"}})}function F(n){const{postId:t,like:c}=n,[o,s]=r.useState(null),[i,l]=r.useState(c?c.length:0),[a,d]=r.useState(!1);r.useEffect(()=>{f().then(h=>{s(h)}).catch(h=>console.error(h));async function f(){return(await(await fetch(`${p}/users`)).json()).user.userId}},[]),r.useEffect(()=>{c&&d(c.some(f=>f.user===o))},[o]);function x(){a?m():j(),d(!a)}async function j(){if((await fetch(`${p}/posts/${t}/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)l(i+1);else throw new Error}async function m(){if((await fetch(`${p}/posts/${t}/like`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)l(i-1);else throw new Error}return e.jsxs("button",{className:"button-like",type:"button",onClick:x,style:{margin:"0 auto"},children:[e.jsx("img",{src:D,alt:"좋아요 이미지",className:`img-like review ${a?"on":""}`}),e.jsx("span",{style:{minWidth:"20px"},children:i})]})}function G({userInfo:n,owner:t,postId:c}){const o=y(),s=r.useRef(null),[i,l]=r.useState(null);r.useEffect(()=>{n!==null&&l(n)},[n]);function a(){N(!0),o(g(!0)),o(T((i==null?void 0:i.nickName)===t)),o(C(c)),o(b("post"))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more postitem",onClick:a,ref:s})}function J({userInfo:n,postInfo:t}){const{subject:c,content:o,like:s,owner:i,photo:l,registeredAt:a,comments:d,title:x,_id:j}=t;return e.jsxs("section",{className:"section-post-content",children:[e.jsx("h3",{"aria-label":"게시글 제목",className:"txt-post-title",children:x}),e.jsxs("div",{children:[e.jsx("p",{"aria-label":"작성자",className:"txt-post-owner",children:i}),e.jsxs("div",{className:"container-post-subinfo",children:[e.jsx(W,{like:s}),e.jsx(q,{comments:d}),e.jsx(H,{registeredAt:a})]})]}),e.jsx(U,{content:o}),e.jsx(F,{postId:j,like:s}),e.jsx(G,{userInfo:n,owner:i,postId:j})]})}function W(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"좋아요 개수"}),e.jsx("dd",{className:"container-count-like",children:e.jsx("span",{children:((t=n.like)==null?void 0:t.length)||0})})]})}function q(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"댓글 개수"}),e.jsx("dd",{className:"container-count-comment",children:e.jsx("span",{children:((t=n.comments)==null?void 0:t.length)||0})})]})}function H(n){var o,s;const{registeredAt:t}=n,c=k(t)?`${(o=t.split(". ").at(-1))==null?void 0:o.split(":")[0]}:${(s=t.split(". ").at(-1))==null?void 0:s.split(":")[1]}`:t.slice(0,13);return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"작성 시간"}),e.jsx("dd",{className:"container-post-time",children:e.jsx("time",{dateTime:"",children:c})})]})}function V(n){const{postId:t,content:c}=n,[o,s]=r.useState(null);r.useEffect(()=>{l().then(a=>{s(a)}).catch(a=>console.error(a));async function l(){return(await(await fetch(`${p}/users/`,{credentials:"include",method:"GET"})).json()).user.nickName}},[]);async function i(){try{if(c!==null&&c.length>0){const l={owner:o,content:c};(await(await fetch(`${p}/posts/${t}/comment`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json()).success===!0&&window.location.reload()}}catch(l){console.error(l)}}return e.jsx("button",{type:"button",onClick:i,disabled:!(c!==null&&c.length>0),"aria-label":"댓글 등록 버튼"})}function z({postId:n}){const[t,c]=r.useState(null);function o(s){c(s.target.value)}return e.jsxs("form",{className:"form-create-comment",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글 작성하기"}),e.jsx("textarea",{id:"comment",onChange:o,minLength:1,maxLength:100}),e.jsx(V,{postId:n,content:t})]})}function Y(){return e.jsx("div",{className:"container-notice comment",children:e.jsx("em",{children:"게시글과 관련없는 홍보성 댓글과 저속한 표현의 비방성 댓글은 삭제될 수 있습니다."})})}function K({userInfo:n,postId:t,comment:c}){const o=y(),s=r.useRef(null),[i,l]=r.useState(null);r.useEffect(()=>{n!==null&&l(n)},[n]);function a(){const d=document.querySelector(".app");d==null||d.classList.add("modal-mode"),o(g(!0)),o(T((i==null?void 0:i.nickName)===c.owner)),o(b("comment")),o(C(t)),o(v(c._id))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more commentitem",onClick:a,ref:s})}function Q({userInfo:n,postId:t,comments:c}){return c&&c.length>0?e.jsx("ul",{children:c.map((o,s)=>e.jsx(X,{userInfo:n,postId:t,comment:o,isLast:s===c.length-1},s))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"댓글이 없어요."})]})}function X({userInfo:n,postId:t,comment:c,isLast:o}){var f,h;const{owner:s,content:i,like:l,registeredAt:a,updatedAt:d}=c,x=u(S=>S.postSlice.editCommentMode),j=k(a)?`${(f=a.split(". ").at(-1))==null?void 0:f.split(":")[0]}:${(h=a.split(". ").at(-1))==null?void 0:h.split(":")[1]}`:a.slice(0,13),m=r.useRef(null);return r.useEffect(()=>{o&&m.current&&m.current.scrollIntoView(!1)},[o]),e.jsxs("li",{className:"li-commentitem",ref:m,children:[e.jsxs("dl",{className:"wrapper-commentitem",children:[e.jsxs("dl",{className:"container-owner-date",children:[e.jsx("dt",{className:"sr-only",children:"댓글 작성자"}),e.jsx("dd",{className:"txt-owner",children:s}),e.jsx("dt",{className:"sr-only",children:"게시 시간"}),e.jsx("dd",{className:"txt-date",children:j})]}),e.jsxs("dl",{children:[e.jsx("dt",{className:"sr-only",children:"댓글 내용"}),x?e.jsx(Z,{content:i}):e.jsx("dd",{className:"txt-content",children:i})]})]}),x?e.jsx(ee,{postId:t,commentId:c._id}):e.jsx(K,{userInfo:n,postId:t,comment:c})]})}function Z({content:n}){const[t,c]=r.useState(n);function o(s){c(s.target.value)}return e.jsx("textarea",{id:"editCommentTextarea",onChange:o,minLength:1,maxLength:100,value:t})}function ee({postId:n,commentId:t}){function c(){const s=document.getElementById("editCommentTextarea");s!==null&&o(s.value)}async function o(s){(await(await fetch(`${p}/comments/${t}?postId=${n}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})})).json()).success?alert("댓글이 수정되었습니다."):alert("다시 시도해주세요."),window.location.reload()}return e.jsx("button",{type:"button",className:"button-more commentitem edit",onClick:c,children:"수정"})}const w=10;function te({postId:n,comments:t,userInfo:c}){const o=y(),s=u(d=>d.paginationSlice.comment),i=u(d=>d.paginationSlice.currentPage),[l,a]=r.useState(s[i-1]);return r.useEffect(()=>{o({type:"paginationSlice/CURRENT_PAGE",currentPage:Object.keys(s).length})},[s]),r.useEffect(()=>{a(s[i-1])},[s,i]),e.jsxs("section",{className:"section-post-comment",children:[t&&t.length>0?e.jsxs("h3",{children:["댓글 ",e.jsxs("span",{children:["(",t.length,")"]})]}):e.jsx("h3",{className:"sr-only",children:"댓글"}),e.jsx(Y,{}),e.jsx(z,{postId:n}),e.jsx(Q,{postId:n,comments:l,userInfo:c}),t&&t.length>w?e.jsx(A,{count:t.length,perPage:w}):null]})}function se(){const[n,t]=r.useState(!1),c=u(s=>s.postSlice.editDeleteNotifyModalOn),o=u(s=>s.postSlice.sameUserOwner);return r.useEffect(()=>{t(c===!0)},[c]),e.jsxs("article",{className:`modal-edit-delete-notify ${n?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:o?e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(oe,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function ne(){const n=y(),t=u(s=>s.postSlice.postId);u(s=>s.postSlice.commentId);const c=u(s=>s.postSlice.accessTarget);function o(){c==="post"?(I(`/community/edit/${t}`),N(!1),n(g(!1))):c==="comment"&&(n(P(!0)),N(!1),n(g(!1)))}return e.jsx("li",{onClick:o,children:"🩹 수정하기"})}function oe(){const n=y(),t=u(a=>a.postSlice.postId),c=u(a=>a.postSlice.commentId),o=u(a=>a.postSlice.accessTarget);async function s(){o==="post"?i():o==="comment"&&l()}async function i(){try{(await(await fetch(`${p}/posts/${t}`,{credentials:"include",method:"DELETE"})).json()).success?I("/community"):alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{N(!1),n(g(!1))}}async function l(){try{(await(await fetch(`${p}/comments/${c}?postId=${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.reload():alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{N(!1),n(g(!1))}}return e.jsx("li",{onClick:s,children:"🗑️ 삭제하기"})}function ce(){const n=u(i=>i.postSlice.editDeleteNotifyModalOn),[t,c]=r.useState(!1),o=y();r.useEffect(()=>{c(n===!0)},[n]),r.useEffect(()=>(t&&document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}),[t]);function s(i){if(i.target.className==="app modal-mode"){const l=document.querySelector(".app");l==null||l.classList.remove("modal-mode"),o(g(!1)),o(C(""))}}return e.jsx("div",{className:`modal-group ${t?"on":""}`,children:e.jsx(se,{})})}function Se(n){const t=y(),[c,o]=R(),s=n.postInfo,{subject:i,content:l,like:a,owner:d,photo:x,registeredAt:j,comments:m,title:f,_id:h}=s;return r.useEffect(()=>{const S={};for(let E=0;E<m.length;E=E+10){const L=m.slice(E,E+10);S[E/10]=L}t(O(S))},[n]),e.jsxs($.Suspense,{fallback:e.jsx(B,{}),children:[e.jsx(_,{title:i}),e.jsxs("main",{className:"main-read-post",children:[e.jsx(J,{userInfo:o,postInfo:s}),e.jsx(te,{userInfo:o,postId:h,comments:m})]}),e.jsx(ce,{})]})}export{Se as Page};
