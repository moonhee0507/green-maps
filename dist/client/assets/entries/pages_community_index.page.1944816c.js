import{r as u,j as t}from"../chunks/chunk-0ad0329c.js";import{B as y,A as f,b as T,c as P,a as x}from"../chunks/chunk-8f8abf42.js";import{n as j}from"../chunks/chunk-c949b376.js";import{S as N}from"../chunks/chunk-009641bb.js";import{u as g}from"../chunks/chunk-da345742.js";import{S as b,T as C,P as A,a as E,u as R}from"../chunks/chunk-0ef4f656.js";import{N as I}from"../chunks/chunk-5b1b7faa.js";import{u as w}from"../chunks/chunk-8c599d12.js";import"../chunks/chunk-af981888.js";import"../chunks/chunk-4a7b83e5.js";import"../chunks/chunk-dfbf6de9.js";import"../chunks/chunk-3c838518.js";function v(){const[e,n]=u.useState(!1),i=u.useRef(null);function s(){var l;const r=`/community/search/${(l=i.current)==null?void 0:l.value}`;j(r,{keepScrollPosition:!0})}return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"search-bar",children:t.jsx("div",{children:e?t.jsxs("div",{children:[t.jsx("label",{htmlFor:"searchItem",className:"sr-only",children:"Í≤åÏãúÍ∏Ä Í≤ÄÏÉâÌïòÍ∏∞"}),t.jsx("input",{type:"search",id:"searchItem",ref:i,autoFocus:!0})]}):t.jsx("h2",{className:"top-title",children:"Í≤åÏãúÌåê"})})}),t.jsx("button",{type:"button",onClick:()=>e?s():n(!0),"aria-label":"ÏãùÎãπ Í≤ÄÏÉâ Î≤ÑÌäº",children:"üîç"})]})}function $(){return t.jsxs("div",{className:"top-bar search",children:[t.jsx(y,{}),t.jsx(v,{})]})}function L(e){const n=g(r=>r.postSlice.post.TOTAL),i=g(r=>r.postSlice.SUBJECT),[s,c]=u.useState(0);return u.useEffect(()=>{r(i).then(l=>c(l.todayCount));async function r(l){const p=encodeURIComponent(l);return await(await fetch(`${f}/today/${p}`,{headers:{"Content-Type":"application/json"}})).json()}},[e.posts]),t.jsxs("div",{className:"container-newpost-selectbox",children:[t.jsxs("p",{className:"txt-postinfo",children:["ÏÉàÍ∏Ä ",t.jsx("span",{children:s}),"/",n]}),t.jsx(N,{})]})}function U(){const[e,n]=u.useState(null),i=u.useRef(null);u.useEffect(()=>{s().then(c=>{c.total>=1?n(c.lists):n(null)})},[]);async function s(){return await(await fetch(`${f}/subjects/${encodeURIComponent("Í≥µÏßÄÏÇ¨Ìï≠")}`,{headers:{"Cache-Control":"max-age=31536000"}})).json()}return t.jsxs("article",{className:"article-notice",children:[t.jsx("h3",{className:"sr-only",children:"Í≥µÏßÄÏÇ¨Ìï≠"}),e!==null?t.jsx("ul",{className:"ul-notice",ref:i,children:e.map((c,r)=>t.jsx(_,{posts:c},Math.random()))}):null]})}function _({posts:e}){const{_id:n,title:i,registeredAt:s,updatedAt:c}=e;return t.jsx("li",{className:"li-notice",children:t.jsx("a",{href:`/community/${n}`,children:t.jsxs("p",{className:"txt-title",children:[t.jsx("span",{children:"[Í≥µÏßÄÏÇ¨Ìï≠] "}),t.jsx("em",{children:i})]})})})}const S=u.forwardRef(k);function k(e,n){const{_id:i,subject:s,owner:c,title:r,content:l,photo:p,like:o,registeredAt:a,comments:h}=e.postInfo,m=G(l),d="80px";return t.jsx("li",{ref:n,children:t.jsxs("a",{href:`/community/${i}`,style:{width:"100%",display:"flex",padding:"20px"},children:[t.jsxs("dl",{style:{width:`calc(100% - ${p&&p.length>0?d:"0px"})`},children:[t.jsx(b,{subject:s}),t.jsx(C,{title:r}),t.jsx(A,{content:m}),t.jsx(E,{owner:c,like:o,registeredAt:a,comments:h})]}),p&&p.length>0?t.jsx("dd",{children:t.jsx("img",{src:p[0].src,alt:"",style:{width:d,height:d,objectFit:"cover"}})}):null]})})}function G(e){return e.replaceAll(/<[^>]*>/g,"").replaceAll(/&[a-zA-Z0-9]*;/g,"")}function B(e){const{posts:n,limit:i}=e,s=u.useRef(null),c=T(),r=P(),[l,p]=R(()=>{const o=Math.ceil(c.getState().postSlice.post.TOTAL/i);c.getState().postSlice.post.CURRENT_PAGE<o&&r({type:"postSlice/POST_IN_PAGE",TOTAL:c.getState().postSlice.post.TOTAL,CURRENT_PAGE:c.getState().postSlice.post.CURRENT_PAGE+1})});return u.useEffect(()=>{const o=Math.ceil(c.getState().postSlice.post.TOTAL/i),a=c.getState().postSlice.post.CURRENT_PAGE;a===o?(p(s.current),console.log(`currentPageÍ∞Ä ${a}Ïù¥Í≥† lastPageÍ∞Ä ${o}Ïó¨ÏÑú Í∞êÏãú Ï§ëÎã®`)):a<o&&(l(s.current),console.log(`currentPageÍ∞Ä ${a}Ïù¥Í≥† lastPageÍ∞Ä ${o}Ïó¨ÏÑú Í∞êÏãú Í≥ÑÏÜç =======`))},[l,p]),t.jsx("ul",{className:"wrapper-posts",children:n.filter(o=>o.subject!=="Í≥µÏßÄÏÇ¨Ìï≠").map((o,a)=>a===n.length-1?(console.log("post",o),console.log("i",a),t.jsx(S,{postInfo:o,ref:s},a)):t.jsx(S,{postInfo:o},a))})}function O(e){const{posts:n,limit:i}=e;return t.jsxs("section",{children:[t.jsx("h3",{className:"sr-only",children:"Í≤åÏãúÍ∏Ä Î™©Î°ù"}),t.jsx(U,{}),t.jsx(B,{posts:n,limit:i})]})}function F({posts:e,limit:n,isLoggedIn:i}){const s=u.useRef(null),[c,r]=u.useState(!1);function l(){var o;(o=s==null?void 0:s.current)==null||o.scrollTo({top:0,left:0,behavior:"auto"})}function p(){var o;((o=s==null?void 0:s.current)==null?void 0:o.scrollTop)===0?r(!1):r(!0)}return t.jsxs(t.Fragment,{children:[t.jsxs("main",{className:"main-community",ref:s,onScroll:p,children:[t.jsx(L,{posts:e}),t.jsx(O,{posts:e,limit:n})]}),c&&t.jsx("button",{id:"buttonGoUp",onClick:l,type:"button",children:"Îß®ÏúÑÎ°ú"})]})}function D({isLoggedIn:e}){function n(){e?j("/community/create"):confirm(`Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.
Î°úÍ∑∏Ïù∏ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)&&j("/login")}return t.jsx("button",{type:"button",className:"link-create",onClick:n,children:"Í∏ÄÏì∞Í∏∞"})}function tt(e){var h;const[n,i]=w(),s=x(m=>m.postSlice.SUBJECT),c=x(m=>m.postSlice.post.CURRENT_PAGE),r=20,[l,p]=u.useState(((h=e.postProps)==null?void 0:h.lists)||[]),o=u.useCallback(async()=>{try{return await(await fetch(`${f}/${s!==""?"subjects/"+s:"posts"}?page=${c}&limit=${r}`,{credentials:"include",headers:{"Content-Type":"application/json"}})).json()}catch(m){console.error(m)}},[c,s]),a=P();return u.useEffect(()=>{o().then(m=>{p(m.currentPage===1?m.lists:[...l,...m.lists]),a({type:"postSlice/POST_IN_PAGE",TOTAL:m.total,CURRENT_PAGE:m.currentPage})})},[o]),t.jsxs(t.Fragment,{children:[t.jsx($,{}),t.jsx(D,{isLoggedIn:n}),t.jsx(F,{posts:l,limit:r,isLoggedIn:n}),t.jsx(I,{isLoggedIn:n})]})}export{tt as Page};
