import{j as e,r,R as $}from"../chunks/chunk-0ad0329c.js";import{A as f,b as g,u as m}from"../chunks/chunk-f5cf074f.js";import{S as L}from"../chunks/chunk-f3107ac8.js";import{T as O}from"../chunks/chunk-fa93ea2c.js";import{D as _}from"../chunks/chunk-4a7b83e5.js";import{i as M}from"../chunks/chunk-9ae07e36.js";import{i as T}from"../chunks/chunk-dfbf6de9.js";import{a as j,S as k,b as S,c as b,d as P,e as D}from"../chunks/chunk-41308c4f.js";import{a as E}from"../chunks/chunk-3258e6a6.js";import{P as v}from"../chunks/chunk-20883e09.js";import{n as I}from"../chunks/chunk-621f058a.js";import{u as A}from"../chunks/chunk-aaa4175a.js";import{L as C}from"../chunks/chunk-c9eff144.js";import"../chunks/chunk-da345742.js";import"../chunks/chunk-bf08ca9a.js";import"../chunks/chunk-0249643f.js";function R(n){const t=n.content;return e.jsx("div",{dangerouslySetInnerHTML:{__html:_.sanitize(t)},style:{wordBreak:"keep-all"}})}function B(n){const{postId:t,like:o}=n,[a,s]=r.useState(null),[c,l]=r.useState(o?o.length:0),[i,d]=r.useState(!1);r.useEffect(()=>{p().then(x=>{s(x)}).catch(x=>console.error(x));async function p(){return(await(await fetch(`${f}/users`)).json()).user.userId}},[]),r.useEffect(()=>{o&&d(o.some(p=>p.user===a))},[a]);function u(){i?y():h(),d(!i)}async function h(){if((await fetch(`${f}/posts/${t}/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:a})})).ok)l(c+1);else throw new Error}async function y(){if((await fetch(`${f}/posts/${t}/like`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:a})})).ok)l(c-1);else throw new Error}return e.jsxs("button",{className:"button-like",type:"button",onClick:u,style:{margin:"0 auto"},children:[e.jsx("img",{src:M,alt:"좋아요 이미지",className:`img-like review ${i?"on":""}`}),e.jsx("span",{style:{minWidth:"20px"},children:c})]})}function U({userInfo:n,owner:t,postId:o}){const a=g(),s=r.useRef(null),[c,l]=r.useState(null);r.useEffect(()=>{n!==null&&l(n)},[n]);function i(){E(!0),a(j(!0)),a(k((c==null?void 0:c.nickName)===t)),a(S(o)),a(b("post"))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more postitem",onClick:i,ref:s})}function F({userInfo:n,postInfo:t}){const{subject:o,content:a,like:s,owner:c,photo:l,registeredAt:i,comments:d,title:u,_id:h}=t;return e.jsxs("section",{className:"section-post-content",children:[e.jsx("h3",{"aria-label":"게시글 제목",className:"txt-post-title",children:u}),e.jsxs("div",{children:[e.jsx("p",{"aria-label":"작성자",className:"txt-post-owner",children:c}),e.jsxs("div",{className:"container-post-subinfo",children:[e.jsx(G,{like:s}),e.jsx(J,{comments:d}),e.jsx(W,{registeredAt:i})]})]}),e.jsx(R,{content:a}),e.jsx(B,{postId:h,like:s}),e.jsx(U,{userInfo:n,owner:c,postId:h})]})}function G(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"좋아요 개수"}),e.jsx("dd",{className:"container-count-like",children:e.jsx("span",{children:((t=n.like)==null?void 0:t.length)||0})})]})}function J(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"댓글 개수"}),e.jsx("dd",{className:"container-count-comment",children:e.jsx("span",{children:((t=n.comments)==null?void 0:t.length)||0})})]})}function W(n){var a,s;const{registeredAt:t}=n,o=T(t)?`${(a=t.split(". ").at(-1))==null?void 0:a.split(":")[0]}:${(s=t.split(". ").at(-1))==null?void 0:s.split(":")[1]}`:t.slice(0,13);return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"작성 시간"}),e.jsx("dd",{className:"container-post-time",children:e.jsx("time",{dateTime:"",children:o})})]})}function q(n){const{postId:t,content:o}=n,[a,s]=r.useState(null);r.useEffect(()=>{l().then(i=>{s(i)}).catch(i=>console.error(i));async function l(){return(await(await fetch(`${f}/users/`,{credentials:"include",method:"GET"})).json()).user.nickName}},[]);async function c(){try{if(o!==null&&o.length>0){const l={owner:a,content:o};(await(await fetch(`${f}/posts/${t}/comment`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json()).success===!0&&window.location.reload()}}catch(l){console.error(l)}}return e.jsx("button",{type:"button",onClick:c,disabled:!(o!==null&&o.length>0),"aria-label":"댓글 등록 버튼"})}function H({postId:n}){const[t,o]=r.useState(null);function a(s){o(s.target.value)}return e.jsxs("form",{className:"form-create-comment",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글 작성하기"}),e.jsx("textarea",{id:"comment",onChange:a,minLength:1,maxLength:100}),e.jsx(q,{postId:n,content:t})]})}function V(){return e.jsx("div",{className:"container-notice comment",children:e.jsx("em",{children:"게시글과 관련없는 홍보성 댓글과 저속한 표현의 비방성 댓글은 삭제될 수 있습니다."})})}function z({userInfo:n,postId:t,comment:o}){const a=g(),s=r.useRef(null),[c,l]=r.useState(null);r.useEffect(()=>{n!==null&&l(n)},[n]);function i(){const d=document.querySelector(".app");d==null||d.classList.add("modal-mode"),a(j(!0)),a(k((c==null?void 0:c.nickName)===o.owner)),a(b("comment")),a(S(t)),a(P(o._id))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more commentitem",onClick:i,ref:s})}function Y({userInfo:n,postId:t,comments:o}){return o&&o.length>0?e.jsx("ul",{children:o.map((a,s)=>e.jsx(K,{userInfo:n,postId:t,comment:a,isLast:s===o.length-1},s))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"댓글이 없어요."})]})}function K({userInfo:n,postId:t,comment:o,isLast:a}){var p,x;const{owner:s,content:c,like:l,registeredAt:i,updatedAt:d}=o,u=m(N=>N.postSlice.editCommentMode),h=T(i)?`${(p=i.split(". ").at(-1))==null?void 0:p.split(":")[0]}:${(x=i.split(". ").at(-1))==null?void 0:x.split(":")[1]}`:i.slice(0,13),y=r.useRef(null);return r.useEffect(()=>{a&&y.current&&y.current.scrollIntoView(!1)},[a]),e.jsxs("li",{className:"li-commentitem",ref:y,children:[e.jsxs("dl",{className:"wrapper-commentitem",children:[e.jsxs("dl",{className:"container-owner-date",children:[e.jsx("dt",{className:"sr-only",children:"댓글 작성자"}),e.jsx("dd",{className:"txt-owner",children:s}),e.jsx("dt",{className:"sr-only",children:"게시 시간"}),e.jsx("dd",{className:"txt-date",children:h})]}),e.jsxs("dl",{children:[e.jsx("dt",{className:"sr-only",children:"댓글 내용"}),u?e.jsx(Q,{content:c}):e.jsx("dd",{className:"txt-content",children:c})]})]}),u?e.jsx(X,{postId:t,commentId:o._id}):e.jsx(z,{userInfo:n,postId:t,comment:o})]})}function Q({content:n}){const[t,o]=r.useState(n);function a(s){o(s.target.value)}return e.jsx("textarea",{id:"editCommentTextarea",onChange:a,minLength:1,maxLength:100,value:t})}function X({postId:n,commentId:t}){function o(){const s=document.getElementById("editCommentTextarea");s!==null&&a(s.value)}async function a(s){(await(await fetch(`${f}/comments/${t}?postId=${n}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})})).json()).success?alert("댓글이 수정되었습니다."):alert("다시 시도해주세요."),window.location.reload()}return e.jsx("button",{type:"button",className:"button-more commentitem edit",onClick:o,children:"수정"})}const w=10;function Z({postId:n,comments:t,userInfo:o}){const a=g(),s=m(d=>d.paginationSlice.comment),c=m(d=>d.paginationSlice.currentPage),[l,i]=r.useState(s[c-1]);return r.useEffect(()=>{a({type:"paginationSlice/CURRENT_PAGE",currentPage:Object.keys(s).length})},[s]),r.useEffect(()=>{i(s[c-1])},[s,c]),e.jsxs("section",{className:"section-post-comment",children:[t&&t.length>0?e.jsxs("h3",{children:["댓글 ",e.jsxs("span",{children:["(",t.length,")"]})]}):e.jsx("h3",{className:"sr-only",children:"댓글"}),e.jsx(V,{}),e.jsx(H,{postId:n}),e.jsx(Y,{postId:n,comments:l,userInfo:o}),t&&t.length>w?e.jsx(v,{count:t.length,perPage:w}):null]})}function ee(){const[n,t]=r.useState(!1),o=m(s=>s.postSlice.editDeleteNotifyModalOn),a=m(s=>s.postSlice.sameUserOwner);return r.useEffect(()=>{t(o===!0)},[o]),e.jsxs("article",{className:`modal-edit-delete-notify ${n?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:a?e.jsxs(e.Fragment,{children:[e.jsx(te,{}),e.jsx(se,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function te(){const n=g(),t=m(s=>s.postSlice.postId);m(s=>s.postSlice.commentId);const o=m(s=>s.postSlice.accessTarget);function a(){o==="post"?(I(`/community/edit/${t}`),E(!1),n(j(!1))):o==="comment"&&(n(D(!0)),E(!1),n(j(!1)))}return e.jsx("li",{onClick:a,children:"🩹 수정하기"})}function se(){const n=g(),t=m(i=>i.postSlice.postId),o=m(i=>i.postSlice.commentId),a=m(i=>i.postSlice.accessTarget);async function s(){a==="post"?c():a==="comment"&&l()}async function c(){try{(await(await fetch(`${f}/posts/${t}`,{credentials:"include",method:"DELETE"})).json()).success?I("/community"):alert("다시 시도해주세요.")}catch(i){console.error(i)}finally{E(!1),n(j(!1))}}async function l(){try{(await(await fetch(`${f}/comments/${o}?postId=${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.reload():alert("다시 시도해주세요.")}catch(i){console.error(i)}finally{E(!1),n(j(!1))}}return e.jsx("li",{onClick:s,children:"🗑️ 삭제하기"})}function ne(){const n=m(c=>c.postSlice.editDeleteNotifyModalOn),[t,o]=r.useState(!1),a=g();r.useEffect(()=>{o(n===!0)},[n]),r.useEffect(()=>(t&&document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}),[t]);function s(c){if(c.target.className==="app modal-mode"){const l=document.querySelector(".app");l==null||l.classList.remove("modal-mode"),a(j(!1)),a(S(""))}}return e.jsx("div",{className:`modal-group ${t?"on":""}`,children:e.jsx(ee,{})})}function Ee(n){const{postId:t}=n,o=g(),[a,s]=A(),[c,l]=r.useState(null);r.useEffect(()=>{i().then(d=>{l(d||null)})},[]);async function i(){return await(await fetch(`${f}/posts/${t}`,{headers:{"Cache-Control":"max-age=31536000"}})).json()}return r.useEffect(()=>{if(c&&c.comments){const d={};for(let u=0;u<c.comments.length;u=u+10){const h=c.comments.slice(u,u+10);d[u/10]=h}o(L(d))}},[c]),c?e.jsxs($.Suspense,{fallback:e.jsx(C,{}),children:[e.jsx(O,{title:c.subject}),e.jsxs("main",{className:"main-read-post",children:[e.jsx(F,{userInfo:s,postInfo:c}),e.jsx(Z,{userInfo:s,postId:c._id,comments:c.comments})]}),e.jsx(ne,{})]}):e.jsx(C,{})}export{Ee as Page};
