import{j as e,r,R as I}from"../chunks/chunk-0ad0329c.js";import{A as h,b as g,u as f}from"../chunks/chunk-f5cf074f.js";import{S as $}from"../chunks/chunk-f3107ac8.js";import{T as L}from"../chunks/chunk-fa93ea2c.js";import{D as P}from"../chunks/chunk-4a7b83e5.js";import{i as _}from"../chunks/chunk-9ae07e36.js";import{i as T}from"../chunks/chunk-dfbf6de9.js";import{a as j,S as k,b as w,c as b,d as M,e as O}from"../chunks/chunk-41308c4f.js";import{a as E}from"../chunks/chunk-3258e6a6.js";import{P as D}from"../chunks/chunk-8275f212.js";import{u as v}from"../chunks/chunk-72fd2dbb.js";import{L as N}from"../chunks/chunk-c9eff144.js";import"../chunks/chunk-da345742.js";import"../chunks/chunk-0249643f.js";function A(o){const t=o.content;return typeof window<"u"?e.jsx("div",{dangerouslySetInnerHTML:{__html:P.sanitize(t)},style:{wordBreak:"keep-all",marginTop:"40px"}}):e.jsx("div",{style:{wordBreak:"keep-all",marginTop:"40px"}})}function R(o){const{postId:t,like:s}=o,[c,n]=r.useState(null),[i,l]=r.useState(s?s.length:0),[a,d]=r.useState(!1);r.useEffect(()=>{x();async function x(){try{const S=await(await fetch(`${h}/users`)).json();S.success?n(S.user.userId):n(null)}catch(y){console.error(y)}}},[]),r.useEffect(()=>{s&&d(s.some(x=>x.user===c))},[c]);function m(){a?p():u(),d(!a)}async function u(){if((await fetch(`${h}/posts/${t}/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:c})})).ok)l(i+1);else throw new Error}async function p(){if((await fetch(`${h}/posts/${t}/like`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:c})})).ok)l(i-1);else throw new Error}return e.jsxs("button",{className:"button-like",type:"button",onClick:m,style:{margin:"60px auto 0px"},children:[e.jsx("img",{src:_,alt:"좋아요 이미지",className:`img-like review ${a?"on":""}`}),e.jsx("span",{style:{minWidth:"20px"},children:i})]})}function B({userInfo:o,owner:t,postId:s}){const c=g(),n=r.useRef(null),[i,l]=r.useState(null);r.useEffect(()=>{o!==null&&l(o)},[o]);function a(){E(!0),c(j(!0)),c(k((i==null?void 0:i.nickName)===t)),c(w(s)),c(b("post"))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more postitem",onClick:a,ref:n})}function U({userInfo:o,postInfo:t}){const{subject:s,content:c,like:n,owner:i,photo:l,registeredAt:a,comments:d,title:m,_id:u}=t;return e.jsxs("section",{className:"section-post-content",children:[e.jsx("h3",{"aria-label":"게시글 제목",className:"txt-post-title",children:m}),e.jsxs("div",{children:[e.jsx("p",{"aria-label":"작성자",className:"txt-post-owner",children:i}),e.jsxs("div",{className:"container-post-subinfo",children:[e.jsx(F,{like:n}),e.jsx(G,{comments:d}),e.jsx(J,{registeredAt:a})]})]}),e.jsx(A,{content:c}),e.jsx(R,{postId:u,like:n}),e.jsx(B,{userInfo:o,owner:i,postId:u})]})}function F(o){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"좋아요 개수"}),e.jsx("dd",{className:"container-count-like",children:e.jsx("span",{children:((t=o.like)==null?void 0:t.length)||0})})]})}function G(o){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"댓글 개수"}),e.jsx("dd",{className:"container-count-comment",children:e.jsx("span",{children:((t=o.comments)==null?void 0:t.length)||0})})]})}function J(o){var c,n;const{registeredAt:t}=o,s=T(t)?`${(c=t.split(". ").at(-1))==null?void 0:c.split(":")[0]}:${(n=t.split(". ").at(-1))==null?void 0:n.split(":")[1]}`:t.slice(0,13);return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"작성 시간"}),e.jsx("dd",{className:"container-post-time",children:e.jsx("time",{dateTime:"",children:s})})]})}function W(o){const{postId:t,content:s}=o;async function c(){return await(await fetch(`${h}/users/`,{credentials:"include",method:"GET"})).json()}function n(){c().then(l=>{l.success===!0?i(l.user.nickName):confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")})}async function i(l){try{if(s!==null&&s.length>0){const a={owner:l,content:s};(await(await fetch(`${h}/posts/${t}/comment`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json()).success===!0&&window.location.reload()}}catch(a){console.error(a)}}return e.jsx("button",{type:"button",onClick:n,disabled:!(s!==null&&s.length>0),"aria-label":"댓글 등록 버튼"})}function q({postId:o}){const[t,s]=r.useState(null);function c(n){s(n.target.value)}return e.jsxs("form",{className:"form-create-comment",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글 작성하기"}),e.jsx("textarea",{id:"comment",onChange:c,minLength:1,maxLength:100}),e.jsx(W,{postId:o,content:t})]})}function H(){return e.jsx("div",{className:"container-notice comment",children:e.jsx("em",{children:"게시글과 관련없는 홍보성 댓글과 저속한 표현의 비방성 댓글은 삭제될 수 있습니다."})})}function V({userInfo:o,postId:t,comment:s}){const c=g(),n=r.useRef(null),[i,l]=r.useState(null);r.useEffect(()=>{o!==null&&l(o)},[o]);function a(){const d=document.querySelector(".app");d==null||d.classList.add("modal-mode"),c(j(!0)),c(k((i==null?void 0:i.nickName)===s.owner)),c(b("comment")),c(w(t)),c(M(s._id))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more commentitem",onClick:a,ref:n})}function z({userInfo:o,postId:t,comments:s}){return s&&s.length>0?e.jsx("ul",{children:s.map((c,n)=>e.jsx(Y,{userInfo:o,postId:t,comment:c,isLast:n===s.length-1},c._id))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"댓글이 없어요."})]})}function Y({userInfo:o,postId:t,comment:s,isLast:c}){var x,y;const{owner:n,content:i,like:l,registeredAt:a,updatedAt:d}=s,m=f(S=>S.postSlice.editCommentMode),u=T(a)?`${(x=a.split(". ").at(-1))==null?void 0:x.split(":")[0]}:${(y=a.split(". ").at(-1))==null?void 0:y.split(":")[1]}`:a.slice(0,13),p=r.useRef(null);return r.useEffect(()=>{c&&p.current&&p.current.scrollIntoView(!1)},[c]),e.jsxs("li",{className:"li-commentitem",ref:p,children:[e.jsxs("dl",{className:"wrapper-commentitem",children:[e.jsxs("dl",{className:"container-owner-date",children:[e.jsx("dt",{className:"sr-only",children:"댓글 작성자"}),e.jsx("dd",{className:"txt-owner",children:n}),e.jsx("dt",{className:"sr-only",children:"게시 시간"}),e.jsx("dd",{className:"txt-date",children:u})]}),e.jsxs("dl",{children:[e.jsx("dt",{className:"sr-only",children:"댓글 내용"}),m?e.jsx(K,{content:i}):e.jsx("dd",{className:"txt-content",children:i})]})]}),m?e.jsx(Q,{postId:t,commentId:s._id}):e.jsx(V,{userInfo:o,postId:t,comment:s})]})}function K({content:o}){const[t,s]=r.useState(o);function c(n){s(n.target.value)}return e.jsx("textarea",{id:"editCommentTextarea",onChange:c,minLength:1,maxLength:100,value:t})}function Q({postId:o,commentId:t}){function s(){const n=document.getElementById("editCommentTextarea");n!==null&&c(n.value)}async function c(n){(await(await fetch(`${h}/comments/${t}?postId=${o}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n})})).json()).success?alert("댓글이 수정되었습니다."):alert("다시 시도해주세요."),window.location.reload()}return e.jsx("button",{type:"button",className:"button-more commentitem edit",onClick:s,children:"수정"})}const C=10;function X({postId:o,comments:t,userInfo:s}){const c=g(),n=f(d=>d.paginationSlice.comment),i=f(d=>d.paginationSlice.currentPage),[l,a]=r.useState(n[i-1]);return r.useEffect(()=>{c({type:"paginationSlice/CURRENT_PAGE",currentPage:Object.keys(n).length})},[n]),r.useEffect(()=>{a(n[i-1])},[n,i]),e.jsxs("section",{className:"section-post-comment",children:[t&&t.length>0?e.jsxs("h3",{children:["댓글 ",e.jsxs("span",{children:["(",t.length,")"]})]}):e.jsx("h3",{className:"sr-only",children:"댓글"}),e.jsx(H,{}),e.jsx(q,{postId:o}),e.jsx(z,{postId:o,comments:l,userInfo:s}),t&&t.length>C?e.jsx(D,{count:t.length,perPage:C}):null]})}function Z(){const[o,t]=r.useState(!1),s=f(n=>n.postSlice.editDeleteNotifyModalOn),c=f(n=>n.postSlice.sameUserOwner);return r.useEffect(()=>{t(s===!0)},[s]),e.jsxs("article",{className:`modal-edit-delete-notify ${o?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:c?e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(te,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function ee(){const o=g(),t=f(n=>n.postSlice.postId);f(n=>n.postSlice.commentId);const s=f(n=>n.postSlice.accessTarget);function c(){s==="post"?(window.location.href=`/community/edit/${t}`,E(!1),o(j(!1))):s==="comment"&&(o(O(!0)),E(!1),o(j(!1)))}return e.jsx("li",{onClick:c,children:"🩹 수정하기"})}function te(){const o=g(),t=f(a=>a.postSlice.postId),s=f(a=>a.postSlice.commentId),c=f(a=>a.postSlice.accessTarget);async function n(){c==="post"?i():c==="comment"&&l()}async function i(){try{(await(await fetch(`${h}/posts/${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.href="/community":alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{E(!1),o(j(!1))}}async function l(){try{(await(await fetch(`${h}/comments/${s}?postId=${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.reload():alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{E(!1),o(j(!1))}}return e.jsx("li",{onClick:n,children:"🗑️ 삭제하기"})}function se(){const o=f(i=>i.postSlice.editDeleteNotifyModalOn),[t,s]=r.useState(!1),c=g();r.useEffect(()=>{s(o===!0)},[o]),r.useEffect(()=>(t&&document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}),[t]);function n(i){if(i.target.className==="app modal-mode"){const l=document.querySelector(".app");l==null||l.classList.remove("modal-mode"),c(j(!1)),c(w(""))}}return e.jsx("div",{className:`modal-group ${t?"on":""}`,children:e.jsx(Z,{})})}const je={title:"게시글 | Green Maps",description:"채식 식당 지도 서비스 게시글 페이지"};function ge(o){const{routeParams:t}=o,[s,c]=r.useState(""),n=g(),[i,l]=v(),[a,d]=r.useState(null);return r.useEffect(()=>{t&&c(t.postId)},[t]),r.useEffect(()=>{typeof s=="string"&&s!==""&&m().then(u=>{d(u||null)});async function m(){return await(await fetch(`${h}/posts/${s}`,{headers:{"Cache-Control":"max-age=31536000"}})).json()}},[s]),r.useEffect(()=>{if(a&&a.comments){const m={};for(let u=0;u<a.comments.length;u=u+10){const p=a.comments.slice(u,u+10);m[u/10]=p}n($(m))}},[a]),a?e.jsxs(I.Suspense,{fallback:e.jsx(N,{}),children:[e.jsx(L,{title:a.subject}),e.jsxs("main",{className:"main-read-post",children:[e.jsx(U,{userInfo:l,postInfo:a}),a.subject!=="공지사항"&&e.jsx(X,{userInfo:l,postId:a._id,comments:a.comments})]}),e.jsx(se,{})]}):e.jsx(N,{})}export{ge as Page,je as documentProps};
//# sourceMappingURL=pages_community_post_index.page.dd57e065.js.map
