import{j as e,r,R as M}from"../chunks/chunk-0ad0329c.js";import{A as h,u as y,a as m}from"../chunks/chunk-453d1d01.js";import{S as O}from"../chunks/chunk-f3107ac8.js";import{T as P}from"../chunks/chunk-08c48d78.js";import{D}from"../chunks/chunk-4a7b83e5.js";import{i as v}from"../chunks/chunk-9ae07e36.js";import{i as I}from"../chunks/chunk-dfbf6de9.js";import{a as j,S as L,b as w,c as $,d as A,e as R}from"../chunks/chunk-41308c4f.js";import{a as g}from"../chunks/chunk-3258e6a6.js";import{P as B}from"../chunks/chunk-9a26e533.js";import{u as U}from"../chunks/chunk-176644ff.js";import{L as b}from"../chunks/chunk-857879ef.js";import"../chunks/chunk-da345742.js";import"../chunks/chunk-1de3b966.js";function F(n){const t=n.content;return typeof window<"u"?e.jsx("div",{dangerouslySetInnerHTML:{__html:D.sanitize(t)},style:{wordBreak:"keep-all",marginTop:"40px"}}):e.jsx("div",{style:{wordBreak:"keep-all",marginTop:"40px"}})}function G(n){const{postId:t,like:i}=n,[o,s]=r.useState(null),[c,l]=r.useState(i?i.length:0),[a,d]=r.useState(!1);r.useEffect(()=>{p();async function p(){try{const S=await(await fetch(`${h}/users`)).json();S.success?s(S.user.userId):s(null)}catch(N){console.error(N)}}},[]),r.useEffect(()=>{i&&d(i.some(p=>p.user===o))},[o]);function u(){a?x():f(),d(!a)}async function f(){if((await fetch(`${h}/posts/${t}/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)l(c+1);else throw new Error}async function x(){if((await fetch(`${h}/posts/${t}/like`,{credentials:"include",method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})})).ok)l(c-1);else throw new Error}return e.jsxs("button",{className:"button-like",type:"button",onClick:u,style:{margin:"60px auto 0px"},children:[e.jsx("img",{src:v,alt:"좋아요 이미지",className:`img-like review ${a?"on":""}`}),e.jsx("span",{style:{minWidth:"20px"},children:c})]})}function J({userInfo:n,owner:t,postId:i}){const o=y(),s=r.useRef(null),[c,l]=r.useState(null),[a,d]=r.useState("");r.useEffect(()=>{n!==null&&l(n),typeof t=="string"&&d(t)},[n]);function u(){g(!0),o(j(!0)),o(L((c==null?void 0:c.nickName)===a)),o(w(i)),o($("post"))}return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more postitem",onClick:u,ref:s})}function W({userInfo:n,postInfo:t}){const{subject:i,content:o,like:s,owner:c,photo:l,registeredAt:a,comments:d,title:u,_id:f}=t,[x,p]=r.useState("");return r.useEffect(()=>{typeof c<"u"&&typeof c.user_id=="object"&&p(c.user_id.nickName)},[c]),e.jsxs("section",{className:"section-post-content",children:[e.jsx("h3",{"aria-label":"게시글 제목",className:"txt-post-title",children:u}),e.jsxs("div",{children:[e.jsx("p",{"aria-label":"작성자",className:"txt-post-owner",children:x}),e.jsxs("div",{className:"container-post-subinfo",children:[e.jsx(q,{like:s}),e.jsx(H,{comments:d}),e.jsx(V,{registeredAt:a})]})]}),e.jsx(F,{content:o}),e.jsx(G,{postId:f,like:s}),e.jsx(J,{userInfo:n,owner:x,postId:f})]})}function q(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"좋아요 개수"}),e.jsx("dd",{className:"container-count-like",children:e.jsx("span",{children:((t=n.like)==null?void 0:t.length)||0})})]})}function H(n){var t;return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"댓글 개수"}),e.jsx("dd",{className:"container-count-comment",children:e.jsx("span",{children:((t=n.comments)==null?void 0:t.length)||0})})]})}function V(n){var o,s;const{registeredAt:t}=n,i=I(t)?`${(o=t.split(". ").at(-1))==null?void 0:o.split(":")[0]}:${(s=t.split(". ").at(-1))==null?void 0:s.split(":")[1]}`:t.slice(0,13);return e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"sr-only",children:"작성 시간"}),e.jsx("dd",{className:"container-post-time",children:e.jsx("time",{dateTime:"",children:i})})]})}function z({postId:n,content:t}){const i=async()=>{const c=await(await fetch(`${h}/users/`,{credentials:"include",method:"GET"})).json();c.success&&c.user?o(c.user._id):confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")};async function o(s){try{if(t!==null&&t.length>0){const c={user_id:s,content:t};(await(await fetch(`${h}/posts/${n}/comment`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json()).success===!0&&window.location.reload()}}catch(c){console.error(c)}}return e.jsx("button",{type:"button",onClick:i,disabled:!(t!==null&&t.length>0),"aria-label":"댓글 등록 버튼"})}function Y({postId:n}){const[t,i]=r.useState(null);function o(s){i(s.target.value)}return e.jsxs("form",{className:"form-create-comment",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글 작성하기"}),e.jsx("textarea",{id:"comment",onChange:o,minLength:1,maxLength:100}),e.jsx(z,{postId:n,content:t})]})}function K(){return e.jsx("div",{className:"container-notice comment",children:e.jsx("em",{children:"게시글과 관련없는 홍보성 댓글과 저속한 표현의 비방성 댓글은 삭제될 수 있습니다."})})}function Q({userInfo:n,postId:t,comment:i}){const o=y(),s=r.useRef(null),[c,l]=r.useState(null),[a,d]=r.useState("");r.useEffect(()=>{n!==null&&l(n),typeof i.owner.user_id=="object"&&d(i.owner.user_id.nickName)},[n,i]);const u=()=>{const f=document.querySelector(".app");f==null||f.classList.add("modal-mode"),o(j(!0)),o(L((c==null?void 0:c.nickName)===a)),o($("comment")),o(w(t)),o(A(i._id))};return e.jsx("button",{type:"button","aria-label":"더보기 버튼",className:"button-more commentitem",onClick:u,ref:s})}function X({userInfo:n,postId:t,comments:i}){return i&&i.length>0?e.jsx("ul",{children:i.map((o,s)=>e.jsx(Z,{userInfo:n,postId:t,comment:o,isLast:s===i.length-1},o._id))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"댓글이 없어요."})]})}function Z({userInfo:n,postId:t,comment:i,isLast:o}){var C,T;const s=m(k=>k.postSlice.commentId),{_id:c,owner:l,content:a,like:d,registeredAt:u,updatedAt:f}=i,x=m(k=>k.postSlice.editCommentMode),[p,N]=r.useState("");r.useEffect(()=>{typeof l<"u"&&typeof l.user_id=="object"&&N(l.user_id.nickName)},[l]);const S=I(u)?`${(C=u.split(". ").at(-1))==null?void 0:C.split(":")[0]}:${(T=u.split(". ").at(-1))==null?void 0:T.split(":")[1]}`:u.slice(0,13),E=r.useRef(null);return r.useEffect(()=>{o&&E.current&&E.current.scrollIntoView(!1)},[o]),e.jsxs("li",{className:"li-commentitem",ref:E,children:[e.jsxs("dl",{className:"wrapper-commentitem",children:[e.jsxs("dl",{className:"container-owner-date",children:[e.jsx("dt",{className:"sr-only",children:"댓글 작성자"}),e.jsx("dd",{className:"txt-owner",children:p}),e.jsx("dt",{className:"sr-only",children:"게시 시간"}),e.jsx("dd",{className:"txt-date",children:S})]}),e.jsxs("dl",{children:[e.jsx("dt",{className:"sr-only",children:"댓글 내용"}),x&&s===c?e.jsx(ee,{content:a}):e.jsx("dd",{className:"txt-content",children:a})]})]}),x&&s===c?e.jsx(te,{postId:t,commentId:i._id}):e.jsx(Q,{userInfo:n,postId:t,comment:i})]})}function ee({content:n}){const[t,i]=r.useState(n);function o(s){i(s.target.value)}return e.jsx("textarea",{id:"editCommentTextarea",onChange:o,minLength:1,maxLength:100,value:t})}function te({postId:n,commentId:t}){function i(){const s=document.getElementById("editCommentTextarea");s!==null&&o(s.value)}async function o(s){(await(await fetch(`${h}/comments/${t}?postId=${n}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})})).json()).success?alert("댓글이 수정되었습니다."):alert("다시 시도해주세요."),window.location.reload()}return e.jsx("button",{type:"button",className:"button-more commentitem edit",onClick:i,children:"수정"})}const _=10;function se({postId:n,comments:t,userInfo:i}){const o=y(),s=m(d=>d.paginationSlice.comment),c=m(d=>d.paginationSlice.currentPage),[l,a]=r.useState(s[c-1]);return r.useEffect(()=>{o({type:"paginationSlice/CURRENT_PAGE",currentPage:Object.keys(s).length})},[s]),r.useEffect(()=>{a(s[c-1])},[s,c]),e.jsxs("section",{className:"section-post-comment",children:[t&&t.length>0?e.jsxs("h3",{children:["댓글 ",e.jsxs("span",{children:["(",t.length,")"]})]}):e.jsx("h3",{className:"sr-only",children:"댓글"}),e.jsx(K,{}),e.jsx(Y,{postId:n}),e.jsx(X,{postId:n,comments:l,userInfo:i}),t&&t.length>_?e.jsx(B,{count:t.length,perPage:_}):null]})}function ne(){const[n,t]=r.useState(!1),i=m(s=>s.postSlice.editDeleteNotifyModalOn),o=m(s=>s.postSlice.sameUserOwner);return r.useEffect(()=>{t(i===!0)},[i]),e.jsxs("article",{className:`modal-edit-delete-notify ${n?"on":""}`,children:[e.jsx("h4",{className:"sr-only",children:"수정, 삭제, 신고용 모달"}),e.jsx("ul",{children:o?e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(ie,{})]}):e.jsx("li",{children:" 🚨 신고하기"})})]})}function oe(){const n=y(),t=m(s=>s.postSlice.postId),i=m(s=>s.postSlice.accessTarget);function o(){i==="post"?(window.location.href=`/community/edit/${t}`,g(!1),n(j(!1))):i==="comment"&&(n(R(!0)),g(!1),n(j(!1)))}return e.jsx("li",{onClick:o,children:"🩹 수정하기"})}function ie(){const n=y(),t=m(a=>a.postSlice.postId),i=m(a=>a.postSlice.commentId),o=m(a=>a.postSlice.accessTarget);async function s(){o==="post"?c():o==="comment"&&l()}async function c(){try{(await(await fetch(`${h}/posts/${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.href="/community":alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{g(!1),n(j(!1))}}async function l(){try{(await(await fetch(`${h}/comments/${i}?postId=${t}`,{credentials:"include",method:"DELETE"})).json()).success?window.location.reload():alert("다시 시도해주세요.")}catch(a){console.error(a)}finally{g(!1),n(j(!1))}}return e.jsx("li",{onClick:s,children:"🗑️ 삭제하기"})}function ce(){const n=m(c=>c.postSlice.editDeleteNotifyModalOn),[t,i]=r.useState(!1),o=y();r.useEffect(()=>{i(n===!0)},[n]),r.useEffect(()=>(t&&document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}),[t]);function s(c){if(c.target.className==="app modal-mode"){const l=document.querySelector(".app");l==null||l.classList.remove("modal-mode"),o(j(!1)),o(w(""))}}return e.jsx("div",{className:`modal-group ${t?"on":""}`,children:e.jsx(ne,{})})}const Se={title:"게시글 | Green Maps",description:"채식 식당 지도 서비스 게시글 페이지"};function Ee(n){const t=y(),[i,o]=U(),[s,c]=r.useState(()=>n.post?n.post:null);return r.useEffect(()=>{if(s&&s.comments){const l={};for(let a=0;a<s.comments.length;a=a+10){const d=s.comments.slice(a,a+10);l[a/10]=d}t(O(l))}},[s]),s?e.jsxs(M.Suspense,{fallback:e.jsx(b,{}),children:[e.jsx(P,{title:s.subject}),e.jsxs("main",{className:"main-read-post",children:[e.jsx(W,{userInfo:o,postInfo:s}),s.subject!=="공지사항"&&e.jsx(se,{userInfo:o,postId:s._id,comments:s.comments})]}),e.jsx(ce,{})]}):e.jsx(b,{})}export{Ee as Page,Se as documentProps};
//# sourceMappingURL=pages_community_post_index.page.0fb7e712.js.map
