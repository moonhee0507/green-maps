import{r as m,j as e}from"./chunk-0ad0329c.js";import"./chunk-da345742.js";import{r as x}from"./chunk-c8344d66.js";import{I as j,a as g,A as y,b as f}from"./chunk-b4acbe02.js";import{s as w}from"./chunk-ce871bab.js";function N({photos:i}){const r=m.useRef(null),l=()=>{var c;t.length>0?o([]):(c=r.current)==null||c.click()},[t,o]=m.useState(()=>{if(window.location.pathname.includes("/edit")&&i&&i.length>0){const s=[];for(let a of i)s.push([`${j}/${a.src}`,a.src.split(".").at(-1)]);return s}else return[]}),n=c=>{const s=c.target.files;if(c.target.files!==null){const a=[];for(let d of s)a.push([URL.createObjectURL(d),d.type]);o(a)}},u=g();return m.useEffect(()=>{var c;if(t){const s=[];for(let a of t){const d=x()+"."+((c=a[1])==null?void 0:c.replace("image/",""));s.push(d)}u({type:"reviewSlice/IMAGE_STATE",FILE_INFO:t,RANDOM_NAME:s})}},[t]),e.jsxs("fieldset",{className:"section-add-picture",children:[e.jsx("legend",{className:"sr-only",children:"사진 첨부"}),e.jsx("div",{className:"container-notice",children:e.jsx("em",{children:"음식 사진이나 메뉴판 사진을 첨부해주세요. (최대 3장)"})}),e.jsxs("ul",{className:"container-picture",children:[e.jsxs("li",{className:`list-add-picture ${t.length>0?"reset":""}`,onClick:l,children:[e.jsx("label",{className:"sr-only",htmlFor:"fileInput"}),e.jsx("input",{type:"file",id:"fileInput",accept:"image/*",onChange:n,style:{display:"none"},multiple:!0,ref:r})]}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>0?e.jsx("img",{src:t[0][0],alt:"첫번째 이미지"}):null}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>1?e.jsx("img",{src:t[1][0],alt:"두번째 이미지"}):null}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>2?e.jsx("img",{src:t[2][0],alt:"세번째 이미지"}):null})]})]})}function T({title:i,content:r}){const l=g(),[t,o]=m.useState(()=>window.location.pathname.includes("/edit")?(l({type:"reviewSlice/TXT_REVIEW_STATE",CONTENT:r}),r):"");function n(u){o(u.currentTarget.value),l({type:"reviewSlice/TXT_REVIEW_STATE",CONTENT:u.currentTarget.value})}return e.jsxs("fieldset",{className:"section-write-review",children:[e.jsx("legend",{className:"sr-only",children:"글 작성"}),e.jsx("label",{className:"sr-only",htmlFor:"restaurantInput",children:"식당이름"}),e.jsx("input",{type:"text",value:i,id:"restaurantInput",readOnly:!0}),e.jsx("label",{htmlFor:"txtReview",className:"sr-only",children:"리뷰 작성란"}),e.jsx("textarea",{id:"txtReview",placeholder:`채식에 대한 이야기를 자유롭게 공유해주세요.
(10자이상 100자 이내)`,autoComplete:"on",maxLength:100,minLength:10,required:!0,onChange:n,value:t})]})}async function S(i,r){if(i.length===r.length)for(let l=0;l<i.length;l++){const t=await fetch(i[l][0]).then(n=>n.blob()).then(n=>new File([n],`${r[l]}`,{type:`${n.type}`})),o={name:`client/${r[l]}`,type:t.type};try{const c=(await(await fetch(`${y}/images/client`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json()).signedUrl;await fetch(c,{method:"PUT",headers:{"Content-Type":t.type},body:t})}catch(n){console.error(n)}}else throw Error("이미지 네이밍 처리에 오류가 발생했습니다.")}function E({restaurantId:i,reviewId:r,userInfo:l}){const[t]=m.useState(window.location.pathname.includes("/edit")),o=f(s=>s.reviewSlice.CONTENT),{userId:n}=l,u=f(s=>s.reviewSlice.image.RANDOM_NAME);async function c(){let s=[];const a=w.getState().reviewSlice.image.FILE_INFO;if(a.length>0)if(a[0][0].includes("https://")){if(a[0][0].includes("https://")){const p=[];for(let h of a)p.push({src:"client/"+h[0].split("client/").at(-1),pick:!0});s=p}}else{await S(a,u);const p=[];for(let h=0;h<a.length;h++)p.push({src:`client/${u[h]}`,pick:!0});s=p}let d;t?d={restaurant:i,photo:s,content:o}:d={owner:n,restaurant:i,photo:s,content:o};try{(await(await fetch(`${y}/reviews/${t?r+"/edit":""}`,{method:t?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json()).success===!0?alert("리뷰가 등록되었습니다."):alert(`리뷰 등록에 실패했습니다.
다시 시도해주세요.`)}catch(p){console.error(p)}finally{window.history.back()}}return e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",onClick:c,className:"styled-button review",children:t?"수정 완료":"작성 완료"})})}function O({restaurantId:i,reviewId:r,title:l,photos:t,content:o,userInfo:n}){return e.jsx("main",{className:"wrapper-review",children:e.jsxs("form",{children:[e.jsx(N,{photos:t}),e.jsx(T,{title:l,content:o}),e.jsx(E,{restaurantId:i,reviewId:r,userInfo:n})]})})}export{O as R};
