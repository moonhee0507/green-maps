import{r as c,j as e}from"./chunk-0ad0329c.js";import"./chunk-da345742.js";import{b as x,A as d,a as p,u as b}from"./chunk-453d1d01.js";import{i as N}from"./chunk-9ae07e36.js";import{S as v}from"./chunk-0a2493d9.js";import{R as S}from"./chunk-cb1bad11.js";import{P as g}from"./chunk-9a26e533.js";import"./chunk-dfbf6de9.js";import"./chunk-2b326172.js";import"./chunk-41308c4f.js";const E="/images/icon-bookmark.svg";function C({restaurantId:t,isLoggedIn:s}){const n=x(),a=c.useCallback(async()=>{if(s)return(await(await fetch(`${d}/users/`,{credentials:"include",method:"GET"})).json()).user.bookmarkList.some(m=>t===m._id)},[t,s]),r=c.useCallback(async()=>{s&&((await fetch(`${d}/users/bookmark/${t}`,{credentials:"include",method:"DELETE"})).ok?n({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:!1}):console.error("북마크 취소에 실패했습니다."))},[t,s]);c.useEffect(()=>{a().then(i=>{n({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:i})})},[a,s]);function u(){s?a().then(i=>i?r():o()):confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")}async function o(){try{if((await fetch(`${d}/users/bookmark`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:t})})).ok)n({type:"buttonSlice/HAS_BOOKMARK_LIST",ON:!0});else throw new Error}catch(i){console.error(i)}}return e.jsxs("button",{className:"button-bookmark",onClick:u,type:"button",children:[e.jsx("img",{src:E,alt:"북마크 이미지",className:p(i=>i.buttonSlice.bookmark.ON?"img-bookmark on":"img-bookmark")}),e.jsx("span",{className:"txt-bookmark",children:"북마크"})]})}function _({restaurantId:t,isLoggedIn:s}){const n=x(),a=c.useCallback(async()=>{if(s)return(await(await fetch(`${d}/users/`,{credentials:"include",method:"GET"})).json()).user.likeList.some(m=>t===m._id)},[t,s]),r=c.useCallback(async()=>{(await fetch(`${d}/users/like/${t}`,{credentials:"include",method:"DELETE"})).ok?n({type:"buttonSlice/HAS_LIKE_LIST",ON:!1}):console.error("좋아요 취소에 실패했습니다.")},[t,s]);c.useEffect(()=>{a().then(i=>{n({type:"buttonSlice/HAS_LIKE_LIST",ON:i})})},[a,s]);function u(){s?a().then(i=>i?r():o()):confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")}async function o(){try{if((await fetch(`${d}/users/like`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:t})})).ok)n({type:"buttonSlice/HAS_LIKE_LIST",ON:!0});else throw new Error}catch(i){console.error(i)}}return e.jsxs("button",{className:"button-like",onClick:u,type:"button",children:[e.jsx("img",{src:N,alt:"좋아요 이미지",className:p(i=>i.buttonSlice.like.ON?"img-like on":"img-like")}),e.jsx("span",{className:"txt-like",children:"좋아요"})]})}const O="/images/icon-share.svg";function T(){const t=()=>{alert("준비 중인 서비스입니다.")};return e.jsxs("button",{className:"button-share",onClick:t,type:"button",children:[e.jsx("img",{src:O,alt:"공유하기 이미지",className:"img-share"}),e.jsx("span",{className:"txt-share",children:"공유하기"})]})}function R({restaurantId:t,isLoggedIn:s}){return e.jsxs("div",{className:"container-bookmark-like-share",children:[e.jsx(C,{restaurantId:t,isLoggedIn:s}),e.jsx(_,{restaurantId:t,isLoggedIn:s}),e.jsx(T,{})]})}const L="/images/icon-copy.svg";function k(t){const s=()=>{window.navigator.clipboard.writeText(t.address),alert("복사되었습니다.")};return e.jsxs("button",{type:"button",onClick:s,children:[e.jsx("img",{src:L,alt:"주소 복사 아이콘",className:"img-copy"}),e.jsx("span",{style:{fontSize:"13px"},children:"복사"})]})}function B(t){return e.jsxs("div",{children:[t.cert?e.jsx("div",{className:"restaurant-cert",children:t.cert}):null,e.jsx("div",{className:"restaurant-category",children:t.category}),e.jsx("h3",{className:"txt-restaurant-title",children:t.title}),e.jsxs("div",{children:[e.jsxs("span",{className:"txt-restaurant-address",children:[t.address," "]}),e.jsx(k,{address:t.address})]})]})}function A({restaurantInfo:t,isLoggedIn:s}){const[n,a]=c.useState(null);return c.useEffect(()=>{t!==null&&a(t)},[t]),n?e.jsxs("section",{className:"section-primary",children:[e.jsx(B,{title:n.title,address:n.address,category:n.category,cert:n.certification}),e.jsx(v,{rating:n.rating}),e.jsx(R,{restaurantId:n._id,isLoggedIn:s})]}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"목록이 없어요."})]})}function P({restaurantInfo:t}){return c.useEffect(()=>{if(t!==null){const{kakao:n}=window,[a,r]=t.location.coordinates,u=document.getElementById("miniMap"),o={center:new n.maps.LatLng(r,a),level:3},i=new n.maps.Map(u,o);var s=new n.maps.Marker({position:new n.maps.LatLng(r,a)});s.setMap(i)}},[]),e.jsxs("section",{className:"section-location",children:[e.jsx("h4",{className:"sr-only",children:"위치"}),e.jsxs("div",{className:"style-wrapper-location-address",children:[e.jsxs("span",{children:[t!==null?t.address:""," "]}),e.jsx(k,{address:t!==null?t.address:""})]}),e.jsx("div",{id:"miniMap"})]})}function $({restaurantId:t,isLoggedIn:s}){function n(){s?window.location.href=`/search/${t}/reviews/create`:confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")}return e.jsx("div",{className:"style-container-write-review",children:e.jsx("button",{type:"button",onClick:n,className:"styled-button",children:"리뷰 작성하기"})})}function K({reviews:t,userInfo:s,restaurantId:n}){return e.jsx("div",{className:"wrapper-review",children:t&&t.length>0?e.jsx("ul",{children:t.map((a,r)=>e.jsx(S,{item:a,userInfo:s,restaurantId:n,isFirst:r===0},a._id))}):e.jsxs("div",{className:"style-wrapper-no-review",children:[e.jsx("div",{className:"txt-no-review",children:"😭"}),e.jsx("p",{children:"리뷰가 아직 없어요."})]})})}function M({restaurantInfo:t,isLoggedIn:s,userInfo:n}){const{_id:a,reviews:r}=t,u=b(),o=p(l=>l.paginationSlice.currentPage),[i,h]=c.useState(0),[m,f]=c.useState(null);c.useEffect(()=>{u({type:"paginationSlice/CURRENT_PAGE",currentPage:1})},[t]);const j=c.useCallback(async()=>await(await fetch(`${d}/restaurants/${a}/reviews`)).json(),[t]),w=c.useCallback(async()=>await(await fetch(`${d}/restaurants/${a}?page=${o}`)).json(),[o]);return c.useEffect(()=>{j().then(l=>{l.success&&h(l.reviews.total)}),w().then(l=>{l.success&&f(l.restaurantInfo.reviews)})},[t,o]),e.jsxs("section",{className:"section-review",children:[e.jsx("h4",{className:"sr-only",children:"리뷰"}),e.jsx($,{restaurantId:a,isLoggedIn:s}),e.jsx(K,{reviews:m,userInfo:n,restaurantId:a}),r&&r.length>0&&e.jsx(g,{count:i,perPage:5})]})}function W({restaurantInfo:t,isLoggedIn:s,userInfo:n}){return e.jsx("main",{className:"wrapper-restaurant-detail",children:t?e.jsxs(e.Fragment,{children:[e.jsx(A,{restaurantInfo:t,isLoggedIn:s}),e.jsx(P,{restaurantInfo:t}),e.jsx(M,{restaurantInfo:t,isLoggedIn:s,userInfo:n})]}):null})}export{W as default};
//# sourceMappingURL=chunk-484d0aaa.js.map
