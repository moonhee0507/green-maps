import{j as t,r as u}from"./chunk-0ad0329c.js";import{S}from"./chunk-877d8d2d.js";import{u as m}from"./chunk-da345742.js";import{A as x,c as g,b as y}from"./chunk-453d1d01.js";import{S as T,T as N,P as b,a as C,u as P}from"./chunk-851d5ddb.js";import"./chunk-176644ff.js";import"./chunk-4a7b83e5.js";import"./chunk-dfbf6de9.js";function A({isLoggedIn:e}){function s(){e?window.location.href="/community/create":confirm(`로그인이 필요한 서비스입니다.
로그인 하시겠습니까?`)&&(window.location.href="/login")}return t.jsx("button",{type:"button",className:"link-create",onClick:s,children:"글쓰기"})}function w(e){const s=m(i=>i.postSlice.post.TOTAL),r=m(i=>i.postSlice.SUBJECT),[o,n]=u.useState(0);return u.useEffect(()=>{i(r).then(a=>n(a.todayCount));async function i(a){const l=encodeURIComponent(a);return await(await fetch(`${x}/today/${l}`,{headers:{"Content-Type":"application/json"}})).json()}},[e.posts]),t.jsxs("div",{className:"container-newpost-selectbox",children:[t.jsxs("p",{className:"txt-postinfo",children:["새글 ",t.jsx("span",{children:o}),"/",s]}),t.jsx(S,{})]})}function R(){const[e,s]=u.useState(null),r=u.useRef(null);u.useEffect(()=>{o().then(n=>{n.total>=1?s(n.lists):s(null)})},[]);async function o(){return await(await fetch(`${x}/subjects/${encodeURIComponent("공지사항")}`,{headers:{"Cache-Control":"max-age=31536000"}})).json()}return t.jsxs("article",{className:"article-notice",children:[t.jsx("h3",{className:"sr-only",children:"공지사항"}),e!==null?t.jsx("ul",{className:"ul-notice",ref:r,children:e.map((n,i)=>t.jsx(E,{posts:n},Math.random()))}):null]})}function E({posts:e}){const{_id:s,title:r,registeredAt:o,updatedAt:n}=e;return t.jsx("li",{className:"li-notice",children:t.jsx("a",{href:`/community/${s}`,children:t.jsxs("p",{className:"txt-title",children:[t.jsx("span",{children:"[공지사항] "}),t.jsx("em",{children:r})]})})})}const f=u.forwardRef(I);function I(e,s){const{_id:r,subject:o,owner:n,title:i,content:a,photo:l,like:c,registeredAt:p,comments:h}=e.postInfo,j=_(a),d="80px";return t.jsx("li",{ref:s,children:t.jsxs("a",{href:`/community/${r.toString()}`,style:{width:"100%",display:"flex",padding:"20px"},children:[t.jsxs("dl",{style:{width:`calc(100% - ${l&&l.length>0?d:"0px"})`},children:[t.jsx(T,{subject:o}),t.jsx(N,{title:i}),t.jsx(b,{content:j}),t.jsx(C,{owner:n.user_id,like:c,registeredAt:p,comments:h})]}),l&&l.length>0?t.jsx("dd",{children:t.jsx("img",{src:l[0].src,alt:"",style:{width:d,height:d,objectFit:"cover"}})}):null]})})}function _(e){return e.replaceAll(/<[^>]*>/g,"").replaceAll(/&[a-zA-Z0-9]*;/g,"")}function U(e){const{posts:s,limit:r}=e,o=u.useRef(null),n=g(),i=y(),[a,l]=P(()=>{const c=Math.ceil(n.getState().postSlice.post.TOTAL/r);n.getState().postSlice.post.CURRENT_PAGE<c&&i({type:"postSlice/POST_IN_PAGE",TOTAL:n.getState().postSlice.post.TOTAL,CURRENT_PAGE:n.getState().postSlice.post.CURRENT_PAGE+1})});return u.useEffect(()=>{const c=Math.ceil(n.getState().postSlice.post.TOTAL/r),p=n.getState().postSlice.post.CURRENT_PAGE;p===c?l(o.current):p<c&&a(o.current)},[a,l]),t.jsx("ul",{className:"wrapper-posts",children:s.map((c,p)=>p===s.length-1?t.jsx(f,{postInfo:c,ref:o},c._id):t.jsx(f,{postInfo:c},c._id))})}function L(e){const{posts:s,limit:r}=e;return t.jsxs("section",{children:[t.jsx("h3",{className:"sr-only",children:"게시글 목록"}),t.jsx(R,{}),t.jsx(U,{posts:s,limit:r})]})}function v({posts:e,limit:s,isLoggedIn:r}){const o=u.useRef(null),[n,i]=u.useState(!1);function a(){var c;(c=o==null?void 0:o.current)==null||c.scrollTo({top:0,left:0,behavior:"auto"})}function l(){var c;((c=o==null?void 0:o.current)==null?void 0:c.scrollTop)===0?i(!1):i(!0)}return t.jsxs(t.Fragment,{children:[t.jsxs("main",{className:"main-community",ref:o,onScroll:l,children:[t.jsx(w,{posts:e}),t.jsx(L,{posts:e,limit:s})]}),n&&t.jsx("button",{id:"buttonGoUp",onClick:a,type:"button",children:"맨위로"})]})}function z({isLoggedIn:e,posts:s,limit:r}){return t.jsxs(t.Fragment,{children:[t.jsx(A,{isLoggedIn:e}),t.jsx(v,{posts:s,limit:r,isLoggedIn:e})]})}export{z as default};
//# sourceMappingURL=chunk-9b993554.js.map
