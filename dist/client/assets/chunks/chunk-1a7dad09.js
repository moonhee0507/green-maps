import{j as s,r}from"./chunk-0ad0329c.js";import{I as L,c as E,A as j}from"./chunk-0fac4abb.js";import{P as C,a as P,S as I,b as M,d as A}from"./chunk-91c16fc8.js";import{R as v}from"./chunk-53b3a789.js";import{P as R}from"./chunk-db086f10.js";import"./chunk-da345742.js";import"./chunk-41308c4f.js";import"./chunk-dfbf6de9.js";import"./chunk-9ae07e36.js";import"./chunk-2b326172.js";import"./chunk-b82a1d50.js";import"./chunk-4a7b83e5.js";function b({host:e}){return s.jsx("div",{className:"container-notice profile",children:s.jsx("em",{children:s.jsxs("span",{children:[(()=>{switch(e){case"local":return"자체 계정";case"kakao":return"다음카카오 계정";case"naver":return"네이버 계정";default:return"자체 계정"}})()," ","회원 입니다."]})})})}const S="/images/default-profile.png";function O({userInfo:e}){return s.jsxs("li",{className:"style-wrapper-profile",children:[s.jsx(T,{userInfo:e}),s.jsx($,{userInfo:e})]})}function T({userInfo:e}){const{profileImage:t}=e,[a,n]=r.useState(S);return r.useEffect(()=>{e.profileImage?t.includes("http://")?n(t):t&&n(`${L}/${t}`):n(S)},[e]),s.jsxs("dl",{children:[s.jsx("dt",{className:"sr-only",children:"프로필 사진"}),s.jsx("dd",{children:s.jsx("div",{className:"container-profile-img",children:s.jsx("img",{src:a,alt:"프로필 사진"})})})]})}function $({userInfo:e}){const{nickName:t,bookmarkList:a,likeList:n,userId:l}=e;return s.jsxs("dl",{className:"wrapper-id-bookmark",children:[s.jsxs("dl",{className:"container-id-nick",children:[s.jsx("dt",{className:"sr-only",children:"아이디"}),s.jsx("dd",{className:"txt-profile-userId",children:l}),s.jsx("dt",{className:"sr-only",children:"닉네임"}),s.jsx("dd",{className:"txt-profile-nickName",children:t})]}),s.jsxs("dl",{className:"container-profile-bookmark-like",children:[s.jsx("dt",{children:"북마크"}),s.jsx("dd",{className:"num-profile-bookmark",children:a.length}),s.jsx("dt",{children:"좋아요"}),s.jsx("dd",{className:"num-profile-like",children:n.length})]})]})}function _({userInfo:e}){const{nickName:t,userId:a}=e,n=E(),l=()=>{c(),n(C(!0))},o=()=>{c(),n(P(!0)),n(I(t))},m=()=>{c(),n(M(!0)),n(A(a))};function c(){const u=document.querySelector(".app");u==null||u.classList.add("modal-mode")}return s.jsxs("li",{className:"list-account",children:[s.jsx("p",{children:"계정"}),s.jsxs("ul",{children:[s.jsx("li",{onClick:l,className:"list-edit",children:"프로필 사진 변경"}),s.jsx("li",{onClick:o,className:"list-edit",children:"닉네임 변경"}),s.jsx("li",{onClick:m,className:"list-edit",children:"비밀번호 변경"})]})]})}function D(){return s.jsxs("li",{className:"list-account",children:[s.jsx("p",{children:"안내"}),s.jsxs("ul",{children:[s.jsx("li",{className:"list-edit",children:s.jsx("a",{href:"",children:"공지사항"})}),s.jsx("li",{className:"list-edit",children:s.jsx("a",{href:"",children:"1:1 문의"})}),s.jsx("li",{className:"list-edit",children:s.jsx("a",{href:"",children:"자주 찾는 질문"})})]})]})}function w({userInfo:e}){async function t(){e.host==="kakao"&&await fetch(`${j}/oauth/kakao/logout`,{method:"POST"}),(await fetch(`${j}/users/logout`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"}})).ok===!0&&(window.localStorage.removeItem("#1"),window.localStorage.removeItem("#2"),window.location.href="/")}return s.jsxs("section",{children:[s.jsx("h3",{className:"sr-only",children:"프로필"}),s.jsx(b,{host:e.host}),s.jsxs("ul",{className:"ul-profile",children:[s.jsx(O,{userInfo:e}),s.jsx(_,{userInfo:e}),s.jsx(D,{})]}),s.jsx("div",{className:"style-wrapper-logout",children:s.jsx("button",{type:"button",onClick:t,className:"styled-button",children:"로그아웃"})})]})}function q({userInfo:e,reviews:t}){const[a,n]=r.useState("");return r.useEffect(()=>{t&&t.length>0&&t.forEach(l=>{typeof l.restaurant=="string"?n(l.restaurant):n(l.restaurant._id)})},[t]),s.jsxs("section",{className:"section-review",children:[s.jsx("h3",{className:"sr-only",children:"식당 리뷰"}),s.jsx("div",{className:"wrapper-review",children:t&&t.length>0?t.map((l,o)=>s.jsx(v,{item:l,userInfo:e,restaurantId:a,isFirst:o===0},Math.random())):s.jsxs("div",{className:"style-wrapper-no-review",children:[s.jsx("div",{className:"txt-no-review",children:"😭"}),s.jsx("p",{children:"리뷰가 아직 없어요."})]})})]})}const F=["작성한 글","댓글 단 글"];function U({userInfo:e}){const[t,a]=r.useState(window.localStorage.getItem("#2")||"작성한 글"),[n,l]=r.useState(null),[o,m]=r.useState({작성한글:0,댓글단글:0}),{nickName:c}=e,u=r.useRef([]);r.useEffect(()=>{const i=window.localStorage.getItem("#2"),h=[...document.querySelectorAll(".list-summary-community")];if(u.current=h,i){const d=F.indexOf(i);d!==-1&&(h[d].classList.add("on"),a(i))}else h[0].classList.add("on"),a("작성한 글");p(c).then(d=>{m(f=>({...f,작성한글:d.posts.length}))}),N(c).then(d=>{m(f=>({...f,댓글단글:d.posts.length}))})},[]),r.useEffect(()=>{t==="작성한 글"?p(c).then(i=>{i.success===!0&&i.posts?l(i.posts):l(null)}):t==="댓글 단 글"&&N(c).then(i=>{i.success===!0&&i.posts?l(i.posts):l(null)})},[t]);function g(){u.current.forEach(i=>{i&&i.classList.remove("on")})}const p=r.useCallback(async i=>await(await fetch(`${j}/posts/my?boundary=post&owner=${i}`)).json(),[]),N=r.useCallback(async i=>await(await fetch(`${j}/posts/my?boundary=comment&owner=${i}`)).json(),[]);function y(i,h){var f,k;const d=i.currentTarget;g(),d.classList.add("on"),h==="작성한 글"?p(c).then(x=>{x.success===!0&&x.posts?l(x.posts):l(null)}):h==="댓글 단 글"&&N(c).then(x=>{x.success===!0&&x.posts?l(x.posts):l(null)}),(f=d.lastElementChild)!=null&&f.innerHTML&&window.localStorage.setItem("#2",(k=d.lastElementChild)==null?void 0:k.innerHTML)}return s.jsxs("section",{children:[s.jsx("h3",{className:"sr-only",children:"내가 쓴 게시글 및 댓글"}),s.jsxs("ul",{className:"ul-summary-community",children:[s.jsxs("li",{className:`list-summary-community ${t==="작성한 글"?"on":""}`,onClick:i=>y(i,"작성한 글"),children:[s.jsx("p",{children:o.작성한글}),s.jsx("p",{children:"작성한 글"})]}),s.jsxs("li",{className:`list-summary-community ${t==="댓글 단 글"?"on":""}`,onClick:i=>y(i,"댓글 단 글"),children:[s.jsx("p",{children:o.댓글단글}),s.jsx("p",{children:"댓글 단 글"})]})]}),n&&n.length>0?s.jsx(R,{posts:n,limit:20}):s.jsxs("div",{className:"style-wrapper-no-review",children:[s.jsx("div",{className:"txt-no-review",children:"😭"}),s.jsx("p",{children:"목록이 없어요."})]})]})}function ss({userInfo:e,reviews:t}){const[a,n]=r.useState("프로필");r.useEffect(()=>{const o=window.localStorage.getItem("#1"),m=["프로필","식당 리뷰","커뮤니티 활동"],c=Array.from(document.querySelectorAll(".list-title"));o?(c[m.indexOf(o)].classList.add("on"),n(o)):c[0].classList.add("on")},[]);function l(o){const m=o.currentTarget;Array.from(document.querySelectorAll(".list-title")).forEach(u=>u.classList.remove("on")),m.classList.add("on"),n(m.innerText),window.localStorage.setItem("#1",m.innerText)}return s.jsxs("main",{className:"main-my",children:[s.jsxs("ul",{className:"ul-title-bar",children:[s.jsx("li",{className:"list-title",onClick:l,children:"프로필"}),s.jsx("li",{className:"list-title",onClick:l,children:"식당 리뷰"}),s.jsx("li",{className:"list-title",onClick:l,children:"커뮤니티 활동"})]}),(()=>{switch(a){case"프로필":return s.jsx(w,{userInfo:e});case"식당 리뷰":return s.jsx(q,{userInfo:e,reviews:t});case"커뮤니티 활동":return s.jsx(U,{userInfo:e});default:return s.jsx(w,{userInfo:e})}})()]})}export{ss as default};
