{"version":3,"file":"chunk-13f560bf.js","sources":["../../../../pages/community/search/ResultSection/PostList/PostListItem.tsx","../../../../pages/community/search/ResultSection/PostList/PostList.tsx"],"sourcesContent":["import React, { ForwardedRef, forwardRef } from 'react';\r\nimport { Title } from '../../../component/PostSection/component/Title';\r\nimport { PreviewText } from '../../../component/PostSection/component/PreviewText';\r\nimport { PostItemDetail } from '../../../component/PostSection/component/PostItemDetail';\r\nimport { Subject } from '../../../component/PostSection/component/Subject';\r\nimport type { Post } from '../../../../../server/models/Post';\r\n\r\nexport default forwardRef(PostListItem);\r\n\r\nfunction PostListItem(props: { postInfo: Post }, ref: ForwardedRef<HTMLLIElement>) {\r\n    const { postInfo } = props;\r\n    const { _id, subject, owner, title, content, photo, like, registeredAt, comments } = postInfo;\r\n\r\n    const removeTagContent = removeUnnecessaryString(content);\r\n\r\n    const imageSize = '80px';\r\n\r\n    return (\r\n        <li ref={ref}>\r\n            <a\r\n                href={`/community/${_id}`}\r\n                style={{\r\n                    width: '100%',\r\n                    display: 'flex',\r\n                    padding: '20px',\r\n                }}\r\n            >\r\n                <dl\r\n                    style={{\r\n                        width: `calc(100% - ${photo && photo.length > 0 ? imageSize : '0px'})`,\r\n                    }}\r\n                >\r\n                    <Subject subject={subject} />\r\n                    <Title title={title} />\r\n                    <PreviewText content={removeTagContent} />\r\n                    <PostItemDetail owner={owner} like={like} registeredAt={registeredAt} comments={comments} />\r\n                </dl>\r\n                {photo && photo.length > 0 ? (\r\n                    <dd>\r\n                        <img\r\n                            src={photo[0].src}\r\n                            alt=\"\"\r\n                            style={{\r\n                                width: imageSize,\r\n                                height: imageSize,\r\n                                objectFit: 'cover',\r\n                            }}\r\n                        />\r\n                    </dd>\r\n                ) : null}\r\n            </a>\r\n        </li>\r\n    );\r\n}\r\n\r\n/**\r\n * Tag와 &nbsp;같은 특수문자 제거 함수\r\n */\r\nfunction removeUnnecessaryString(html: string): string {\r\n    return html.replaceAll(/<[^>]*>/g, '').replaceAll(/&[a-zA-Z0-9]*;/g, '');\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport PostListItem from './PostListItem';\r\nimport type { Post } from '../../../../../server/models/Post';\r\nimport { useDispatch, useStore } from 'react-redux';\r\nimport useIntersectionObserver from '../../../useIntersectionObserver';\r\n\r\nexport { PostList };\r\n\r\nfunction PostList(props: { posts: Post[]; limit: number }) {\r\n    const { posts, limit } = props;\r\n    const target = useRef<HTMLLIElement>(null);\r\n\r\n    const store = useStore<any>();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const [observe, unobserve] = useIntersectionObserver(() => {\r\n        // 현재 페이지가 마지막 페이지가 아닐 때만 페이지 증가\r\n        const lastPage = Math.ceil(store.getState().postSlice.post.TOTAL / limit);\r\n        const currentPage = store.getState().postSlice.post.CURRENT_PAGE;\r\n\r\n        if (currentPage < lastPage) {\r\n            dispatch({\r\n                type: 'postSlice/POST_IN_PAGE',\r\n                TOTAL: store.getState().postSlice.post.TOTAL,\r\n                CURRENT_PAGE: store.getState().postSlice.post.CURRENT_PAGE + 1,\r\n            });\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        const lastPage = Math.ceil(store.getState().postSlice.post.TOTAL / limit);\r\n        const currentPage = store.getState().postSlice.post.CURRENT_PAGE;\r\n\r\n        if (currentPage === lastPage) {\r\n            unobserve(target.current);\r\n            // console.log(`currentPage가 ${currentPage}이고 lastPage가 ${lastPage}여서 감시 중단`);\r\n        } else if (currentPage < lastPage) {\r\n            observe(target.current);\r\n            // console.log(`currentPage가 ${currentPage}이고 lastPage가 ${lastPage}여서 감시 계속 =======`);\r\n        }\r\n    }, [observe, unobserve, target]);\r\n\r\n    return (\r\n        <ul className=\"wrapper-posts\">\r\n            {posts.map((post, i) => {\r\n                if (i === posts.length - 1) {\r\n                    return <PostListItem key={post._id} postInfo={post} ref={target} />;\r\n                } else return <PostListItem key={post._id} postInfo={post} />;\r\n            })}\r\n        </ul>\r\n    );\r\n}\r\n"],"names":["PostListItem","forwardRef","props","ref","postInfo","_id","subject","owner","title","content","photo","like","registeredAt","comments","removeTagContent","removeUnnecessaryString","imageSize","jsx","jsxs","Subject","Title","PreviewText","PostItemDetail","html","PostList","posts","limit","target","useRef","store","useStore","dispatch","useDispatch","observe","unobserve","useIntersectionObserver","lastPage","useEffect","currentPage","post","i"],"mappings":"yLAOA,MAAAA,EAAeC,aAAWD,CAAY,EAEtC,SAASA,EAAaE,EAA2BC,EAAkC,CACzE,KAAA,CAAE,SAAAC,CAAa,EAAAF,EACf,CAAE,IAAAG,EAAK,QAAAC,EAAS,MAAAC,EAAO,MAAAC,EAAO,QAAAC,EAAS,MAAAC,EAAO,KAAAC,EAAM,aAAAC,EAAc,SAAAC,CAAA,EAAaT,EAE/EU,EAAmBC,EAAwBN,CAAO,EAElDO,EAAY,OAGd,OAAAC,EAAA,IAAC,MAAG,IAAAd,EACA,SAAAe,EAAA,KAAC,IAAA,CACG,KAAM,cAAcb,IACpB,MAAO,CACH,MAAO,OACP,QAAS,OACT,QAAS,MACb,EAEA,SAAA,CAAAa,EAAA,KAAC,KAAA,CACG,MAAO,CACH,MAAO,eAAeR,GAASA,EAAM,OAAS,EAAIM,EAAY,QAClE,EAEA,SAAA,CAAAC,MAACE,GAAQ,QAAAb,EAAkB,EAC3BW,MAACG,GAAM,MAAAZ,EAAc,EACrBS,EAAAA,IAACI,EAAY,CAAA,QAASP,CAAkB,CAAA,EACvCG,EAAA,IAAAK,EAAA,CAAe,MAAAf,EAAc,KAAAI,EAAY,aAAAC,EAA4B,SAAAC,EAAoB,CAAA,CAAA,CAC9F,EACCH,GAASA,EAAM,OAAS,QACpB,KACG,CAAA,SAAAO,EAAA,IAAC,MAAA,CACG,IAAKP,EAAM,CAAC,EAAE,IACd,IAAI,GACJ,MAAO,CACH,MAAOM,EACP,OAAQA,EACR,UAAW,OACf,CAAA,GAER,EACA,IAAA,CAAA,CAEZ,CAAA,CAAA,CAER,CAKA,SAASD,EAAwBQ,EAAsB,CACnD,OAAOA,EAAK,WAAW,WAAY,EAAE,EAAE,WAAW,kBAAmB,EAAE,CAC3E,CCpDA,SAASC,EAAStB,EAAyC,CACjD,KAAA,CAAE,MAAAuB,EAAO,MAAAC,CAAU,EAAAxB,EACnByB,EAASC,SAAsB,IAAI,EAEnCC,EAAQC,IAERC,EAAWC,IAEX,CAACC,EAASC,CAAS,EAAIC,EAAwB,IAAM,CAEjD,MAAAC,EAAW,KAAK,KAAKP,EAAM,WAAW,UAAU,KAAK,MAAQH,CAAK,EACpDG,EAAM,SAAS,EAAE,UAAU,KAAK,aAElCO,GACLL,EAAA,CACL,KAAM,yBACN,MAAOF,EAAM,SAAS,EAAE,UAAU,KAAK,MACvC,aAAcA,EAAM,SAAA,EAAW,UAAU,KAAK,aAAe,CAAA,CAChE,CACL,CACH,EAEDQ,OAAAA,EAAAA,UAAU,IAAM,CACN,MAAAD,EAAW,KAAK,KAAKP,EAAM,WAAW,UAAU,KAAK,MAAQH,CAAK,EAClEY,EAAcT,EAAM,SAAS,EAAE,UAAU,KAAK,aAEhDS,IAAgBF,EAChBF,EAAUP,EAAO,OAAO,EAEjBW,EAAcF,GACrBH,EAAQN,EAAO,OAAO,CAG3B,EAAA,CAACM,EAASC,EAAWP,CAAM,CAAC,EAG3BV,MAAC,MAAG,UAAU,gBACT,WAAM,IAAI,CAACsB,EAAMC,IACVA,IAAMf,EAAM,OAAS,QACbzB,EAA4B,CAAA,SAAUuC,EAAM,IAAKZ,CAAA,EAA/BY,EAAK,GAAkC,EACtDtB,EAAAA,IAAAjB,EAAA,CAA4B,SAAUuC,GAApBA,EAAK,GAAqB,CAC9D,CACL,CAAA,CAER"}