import{r as h,j as e}from"./chunk-0ad0329c.js";import"./chunk-da345742.js";import{r as y}from"./chunk-c8344d66.js";import{I as x,c as f,A as g,a as m}from"./chunk-8f8abf42.js";import{s as j}from"./chunk-dbf1858e.js";function w({photos:l}){const r=h.useRef(null),i=()=>{var n;t.length>0?o([]):(n=r.current)==null||n.click()},[t,o]=h.useState(()=>{if(window.location.pathname.includes("/edit")&&l&&l.length>0){const a=[];for(let u of l)a.push([`${x}/${u.src}`,u.src.split(".").at(-1)]);return a}else return[]}),s=n=>{const a=n.target.files;if(n.target.files!==null){const u=[];for(let c of a)u.push([URL.createObjectURL(c),c.type]);o(u)}},d=f();return h.useEffect(()=>{var n;if(t){const a=[];for(let u of t){const c=y()+"."+((n=u[1])==null?void 0:n.replace("image/",""));a.push(c)}d({type:"reviewSlice/IMAGE_STATE",FILE_INFO:t,RANDOM_NAME:a})}},[t]),e.jsxs("fieldset",{className:"section-add-picture",children:[e.jsx("legend",{className:"sr-only",children:"사진 첨부"}),e.jsx("div",{className:"container-notice",children:e.jsx("em",{children:"음식 사진이나 메뉴판 사진을 첨부해주세요. (최대 3장)"})}),e.jsxs("ul",{className:"container-picture",children:[e.jsxs("li",{className:`list-add-picture ${t.length>0?"reset":""}`,onClick:i,children:[e.jsx("label",{className:"sr-only",htmlFor:"fileInput"}),e.jsx("input",{type:"file",id:"fileInput",accept:"image/*",onChange:s,style:{display:"none"},multiple:!0,ref:r})]}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>0?e.jsx("img",{src:t[0][0],alt:"첫번째 이미지"}):null}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>1?e.jsx("img",{src:t[1][0],alt:"두번째 이미지"}):null}),e.jsx("li",{className:"list-picture","area-label":"추가한 이미지 리스트",children:t.length>2?e.jsx("img",{src:t[2][0],alt:"세번째 이미지"}):null})]})]})}function N({title:l,content:r}){const i=f(),[t,o]=h.useState(()=>window.location.pathname.includes("/edit")?(i({type:"reviewSlice/TXT_REVIEW_STATE",CONTENT:r}),r):"");function s(d){o(d.currentTarget.value),i({type:"reviewSlice/TXT_REVIEW_STATE",CONTENT:d.currentTarget.value})}return e.jsxs("fieldset",{className:"section-write-review",children:[e.jsx("legend",{className:"sr-only",children:"글 작성"}),e.jsx("label",{className:"sr-only",htmlFor:"restaurantInput",children:"식당이름"}),e.jsx("input",{type:"text",value:l,id:"restaurantInput",readOnly:!0}),e.jsx("label",{htmlFor:"txtReview",className:"sr-only",children:"리뷰 작성란"}),e.jsx("textarea",{id:"txtReview",placeholder:`채식에 대한 이야기를 자유롭게 공유해주세요.
(10자이상 100자 이내)`,autoComplete:"on",maxLength:100,minLength:10,required:!0,onChange:s,value:t})]})}async function T(l,r){if(l.length===r.length)for(let i=0;i<l.length;i++){const t=await fetch(l[i][0]).then(s=>s.blob()).then(s=>new File([s],`${r[i]}`,{type:`${s.type}`})),o={name:`client/${r[i]}`,type:t.type};try{const n=(await(await fetch(`${g}/images/client`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json()).signedUrl;await fetch(n,{method:"PUT",headers:{"Content-Type":t.type},body:t})}catch(s){console.error(s)}}else throw Error("이미지 네이밍 처리에 오류가 발생했습니다.")}function S({restaurantId:l,reviewId:r,userInfo:i}){const[t]=h.useState(window.location.pathname.includes("/edit")),o=m(n=>n.reviewSlice.CONTENT),s=m(n=>n.reviewSlice.image.RANDOM_NAME);async function d(){let n=[];const a=j.getState().reviewSlice.image.FILE_INFO;if(a.length>0)if(a[0][0].includes("amazon")){if(a[0][0].includes("amazon")){const c=[];for(let p of a)c.push({src:"client/"+p[0].split("client/").at(-1),pick:!0});n=c}}else{await T(a,s);const c=[];for(let p=0;p<a.length;p++)c.push({src:`client/${s[p]}`,pick:!0});n=c}let u;t?u={restaurant:l,photo:n,content:o}:u={owner:i?i.userId:"",restaurant:l,photo:n,content:o};try{(await(await fetch(`${g}/reviews/${t?r+"/edit":""}`,{credentials:"include",method:t?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json()).success===!0?alert("리뷰가 등록되었습니다."):alert(`리뷰 등록에 실패했습니다.
다시 시도해주세요.`)}catch(c){console.error(c)}finally{window.history.back()}}return e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",onClick:d,className:"styled-button review",children:t?"수정 완료":"작성 완료"})})}function R({restaurantId:l,reviewId:r,title:i,photos:t,content:o,userInfo:s}){return e.jsx("main",{className:"wrapper-review",children:e.jsxs("form",{children:[e.jsx(w,{photos:t}),e.jsx(N,{title:i,content:o}),e.jsx(S,{restaurantId:l,reviewId:r,userInfo:s})]})})}export{R};
