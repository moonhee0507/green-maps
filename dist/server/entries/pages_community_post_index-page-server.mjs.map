{"version":3,"file":"pages_community_post_index-page-server.mjs","sources":["../../../pages/community/post/index.page.server.ts"],"sourcesContent":["import fetch from 'node-fetch';\r\nimport { RenderErrorPage } from 'vite-plugin-ssr/RenderErrorPage';\r\nimport { API_URL } from '../../../renderer/CONSTANT_URL';\r\nimport type { PageContext } from '../../../renderer/types';\r\n\r\nexport const documentProps = {\r\n    title: '게시글 | Green Maps',\r\n    description: '채식 식당 지도 서비스 게시글 페이지',\r\n};\r\n\r\nexport { onBeforeRender };\r\n\r\nasync function onBeforeRender(pageContext: PageContext) {\r\n    const { routeParams } = pageContext;\r\n\r\n    if (routeParams) {\r\n        if (Object.hasOwn(routeParams, 'postId')) {\r\n            const { postId } = routeParams;\r\n            const res = await fetch(`${API_URL}/posts/${postId}`, {\r\n                headers: {\r\n                    'Cache-Control': 'max-age=31536000',\r\n                },\r\n            });\r\n\r\n            if (res.status === 200) {\r\n                const post = await res.json();\r\n                return {\r\n                    pageContext: {\r\n                        post: post,\r\n                    },\r\n                };\r\n            } else {\r\n                throw RenderErrorPage({\r\n                    pageContext: {\r\n                        redirectTo: '/community',\r\n                    },\r\n                });\r\n            }\r\n        } else {\r\n            throw RenderErrorPage({\r\n                pageContext: {\r\n                    redirectTo: '/community',\r\n                },\r\n            });\r\n        }\r\n    } else {\r\n        throw RenderErrorPage({\r\n            pageContext: {\r\n                redirectTo: '/community',\r\n            },\r\n        });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;AAKO,MAAM,gBAAgB;AAAA,EACzB,OAAO;AAAA,EACP,aAAa;AACjB;AAIA,eAAe,eAAe,aAA0B;AAC9C,QAAA,EAAE,YAAgB,IAAA;AAExB,MAAI,aAAa;AACb,QAAI,OAAO,OAAO,aAAa,QAAQ,GAAG;AAChC,YAAA,EAAE,OAAW,IAAA;AACnB,YAAM,MAAM,MAAM,MAAM,GAAG,iBAAiB,UAAU;AAAA,QAClD,SAAS;AAAA,UACL,iBAAiB;AAAA,QACrB;AAAA,MAAA,CACH;AAEG,UAAA,IAAI,WAAW,KAAK;AACd,cAAA,OAAO,MAAM,IAAI;AAChB,eAAA;AAAA,UACH,aAAa;AAAA,YACT;AAAA,UACJ;AAAA,QAAA;AAAA,MACJ,OACG;AACH,cAAM,gBAAgB;AAAA,UAClB,aAAa;AAAA,YACT,YAAY;AAAA,UAChB;AAAA,QAAA,CACH;AAAA,MACL;AAAA,IAAA,OACG;AACH,YAAM,gBAAgB;AAAA,QAClB,aAAa;AAAA,UACT,YAAY;AAAA,QAChB;AAAA,MAAA,CACH;AAAA,IACL;AAAA,EAAA,OACG;AACH,UAAM,gBAAgB;AAAA,MAClB,aAAa;AAAA,QACT,YAAY;AAAA,MAChB;AAAA,IAAA,CACH;AAAA,EACL;AACJ;"}