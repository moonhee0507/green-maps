{"version":3,"file":"chunk-64cb3e56.js","sources":["../../../pages/community/search/ResultSection/PostList/PostListItem.tsx","../../../pages/community/search/ResultSection/PostList/PostList.tsx"],"sourcesContent":["import React, { ForwardedRef, forwardRef } from 'react';\r\nimport { Title } from '../../../component/PostSection/component/Title';\r\nimport { PreviewText } from '../../../component/PostSection/component/PreviewText';\r\nimport { PostItemDetail } from '../../../component/PostSection/component/PostItemDetail';\r\nimport { Subject } from '../../../component/PostSection/component/Subject';\r\nimport type { Post } from '../../../../../server/models/Post';\r\n\r\nexport default forwardRef(PostListItem);\r\n\r\nfunction PostListItem(props: { postInfo: Post }, ref: ForwardedRef<HTMLLIElement>) {\r\n    const { postInfo } = props;\r\n    const { _id, subject, owner, title, content, photo, like, registeredAt, comments } = postInfo;\r\n\r\n    const removeTagContent = removeUnnecessaryString(content);\r\n\r\n    const imageSize = '80px';\r\n\r\n    return (\r\n        <li ref={ref}>\r\n            <a\r\n                href={`/community/${_id}`}\r\n                style={{\r\n                    width: '100%',\r\n                    display: 'flex',\r\n                    padding: '20px',\r\n                }}\r\n            >\r\n                <dl\r\n                    style={{\r\n                        width: `calc(100% - ${photo && photo.length > 0 ? imageSize : '0px'})`,\r\n                    }}\r\n                >\r\n                    <Subject subject={subject} />\r\n                    <Title title={title} />\r\n                    <PreviewText content={removeTagContent} />\r\n                    <PostItemDetail owner={owner} like={like} registeredAt={registeredAt} comments={comments} />\r\n                </dl>\r\n                {photo && photo.length > 0 ? (\r\n                    <dd>\r\n                        <img\r\n                            src={photo[0].src}\r\n                            alt=\"\"\r\n                            style={{\r\n                                width: imageSize,\r\n                                height: imageSize,\r\n                                objectFit: 'cover',\r\n                            }}\r\n                        />\r\n                    </dd>\r\n                ) : null}\r\n            </a>\r\n        </li>\r\n    );\r\n}\r\n\r\n/**\r\n * Tag와 &nbsp;같은 특수문자 제거 함수\r\n */\r\nfunction removeUnnecessaryString(html: string): string {\r\n    return html.replaceAll(/<[^>]*>/g, '').replaceAll(/&[a-zA-Z0-9]*;/g, '');\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport PostListItem from './PostListItem';\r\nimport type { Post } from '../../../../../server/models/Post';\r\nimport { useDispatch, useStore } from 'react-redux';\r\nimport useIntersectionObserver from '../../../useIntersectionObserver';\r\n\r\nexport { PostList };\r\n\r\nfunction PostList(props: { posts: Post[]; limit: number }) {\r\n    const { posts, limit } = props;\r\n    const target = useRef<HTMLLIElement>(null);\r\n\r\n    const store = useStore<any>();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const [observe, unobserve] = useIntersectionObserver(() => {\r\n        // 현재 페이지가 마지막 페이지가 아닐 때만 페이지 증가\r\n        const lastPage = Math.ceil(store.getState().postSlice.post.TOTAL / limit);\r\n        const currentPage = store.getState().postSlice.post.CURRENT_PAGE;\r\n\r\n        if (currentPage < lastPage) {\r\n            dispatch({\r\n                type: 'postSlice/POST_IN_PAGE',\r\n                TOTAL: store.getState().postSlice.post.TOTAL,\r\n                CURRENT_PAGE: store.getState().postSlice.post.CURRENT_PAGE + 1,\r\n            });\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        const lastPage = Math.ceil(store.getState().postSlice.post.TOTAL / limit);\r\n        const currentPage = store.getState().postSlice.post.CURRENT_PAGE;\r\n\r\n        if (currentPage === lastPage) {\r\n            unobserve(target.current);\r\n            // console.log(`currentPage가 ${currentPage}이고 lastPage가 ${lastPage}여서 감시 중단`);\r\n        } else if (currentPage < lastPage) {\r\n            observe(target.current);\r\n            // console.log(`currentPage가 ${currentPage}이고 lastPage가 ${lastPage}여서 감시 계속 =======`);\r\n        }\r\n    }, [observe, unobserve, target]);\r\n\r\n    return (\r\n        <ul className=\"wrapper-posts\">\r\n            {posts.map((post, i) => {\r\n                if (i === posts.length - 1) {\r\n                    return <PostListItem key={post._id} postInfo={post} ref={target} />;\r\n                } else return <PostListItem key={post._id} postInfo={post} />;\r\n            })}\r\n        </ul>\r\n    );\r\n}\r\n"],"names":["PostListItem"],"mappings":";;;;AAOA,MAAA,eAAe,WAAWA,cAAY;AAEtC,SAASA,eAAa,OAA2B,KAAkC;AACzE,QAAA,EAAE,SAAa,IAAA;AACf,QAAA,EAAE,KAAK,SAAS,OAAO,OAAO,SAAS,OAAO,MAAM,cAAc,SAAA,IAAa;AAE/E,QAAA,mBAAmB,wBAAwB,OAAO;AAExD,QAAM,YAAY;AAGd,SAAA,oBAAC,QAAG,KACA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACG,MAAM,cAAc;AAAA,MACpB,OAAO;AAAA,QACH,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS;AAAA,MACb;AAAA,MAEA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACG,OAAO;AAAA,cACH,OAAO,eAAe,SAAS,MAAM,SAAS,IAAI,YAAY;AAAA,YAClE;AAAA,YAEA,UAAA;AAAA,cAAA,oBAAC,WAAQ,SAAkB;AAAA,cAC3B,oBAAC,SAAM,OAAc;AAAA,cACrB,oBAAC,aAAY,EAAA,SAAS,iBAAkB,CAAA;AAAA,cACvC,oBAAA,gBAAA,EAAe,OAAc,MAAY,cAA4B,UAAoB;AAAA,YAAA;AAAA,UAAA;AAAA,QAC9F;AAAA,QACC,SAAS,MAAM,SAAS,wBACpB,MACG,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACG,KAAK,MAAM,CAAC,EAAE;AAAA,YACd,KAAI;AAAA,YACJ,OAAO;AAAA,cACH,OAAO;AAAA,cACP,QAAQ;AAAA,cACR,WAAW;AAAA,YACf;AAAA,UAAA;AAAA,WAER,IACA;AAAA,MAAA;AAAA,IAAA;AAAA,EAEZ,EAAA,CAAA;AAER;AAKA,SAAS,wBAAwB,MAAsB;AACnD,SAAO,KAAK,WAAW,YAAY,EAAE,EAAE,WAAW,mBAAmB,EAAE;AAC3E;ACpDA,SAAS,SAAS,OAAyC;AACjD,QAAA,EAAE,OAAO,MAAU,IAAA;AACnB,QAAA,SAAS,OAAsB,IAAI;AAEzC,QAAM,QAAQ;AAEd,QAAM,WAAW;AAEjB,QAAM,CAAC,SAAS,SAAS,IAAI,wBAAwB,MAAM;AAEjD,UAAA,WAAW,KAAK,KAAK,MAAM,WAAW,UAAU,KAAK,QAAQ,KAAK;AACxE,UAAM,cAAc,MAAM,SAAS,EAAE,UAAU,KAAK;AAEpD,QAAI,cAAc,UAAU;AACf,eAAA;AAAA,QACL,MAAM;AAAA,QACN,OAAO,MAAM,SAAS,EAAE,UAAU,KAAK;AAAA,QACvC,cAAc,MAAM,SAAA,EAAW,UAAU,KAAK,eAAe;AAAA,MAAA,CAChE;AAAA,IACL;AAAA,EAAA,CACH;AAED,YAAU,MAAM;AACN,UAAA,WAAW,KAAK,KAAK,MAAM,WAAW,UAAU,KAAK,QAAQ,KAAK;AACxE,UAAM,cAAc,MAAM,SAAS,EAAE,UAAU,KAAK;AAEpD,QAAI,gBAAgB,UAAU;AAC1B,gBAAU,OAAO,OAAO;AAAA,IAAA,WAEjB,cAAc,UAAU;AAC/B,cAAQ,OAAO,OAAO;AAAA,IAE1B;AAAA,EACD,GAAA,CAAC,SAAS,WAAW,MAAM,CAAC;AAG3B,SAAA,oBAAC,QAAG,WAAU,iBACT,gBAAM,IAAI,CAAC,MAAM,MAAM;AAChB,QAAA,MAAM,MAAM,SAAS,GAAG;AACxB,iCAAQ,cAA4B,EAAA,UAAU,MAAM,KAAK,OAAA,GAA/B,KAAK,GAAkC;AAAA,IACrE;AAAO,aAAQ,oBAAA,cAAA,EAA4B,UAAU,QAApB,KAAK,GAAqB;AAAA,EAC9D,CAAA,EACL,CAAA;AAER;"}