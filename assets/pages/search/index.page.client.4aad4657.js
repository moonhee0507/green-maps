import{a as p,F as w,j as i,r as v}from"../../chunks/0e184ced.js";import{B as y}from"../../chunks/b9c07719.js";import{s as L,u as k}from"../../chunks/2cfb98b7.js";const x="/green-maps/images/icon-location.svg",B="/green-maps/images/icon-auth.svg",{kakao:t}=window;let o,l,u,g,h;function C(){const a=document.getElementById("map"),n={center:new t.maps.LatLng(37.5666805,126.9784147),level:3};o=new t.maps.Map(a,n),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){const c=e.coords.latitude,s=e.coords.longitude,r=new t.maps.LatLng(c,s);o.setCenter(r)}):console.log("❌ 현재 위치를 표시할 수 없습니다"),t.maps.event.addListener(o,"bounds_changed",function(){l=o.getBounds().getNorthEast().getLat(),u=o.getBounds().getNorthEast().getLng(),g=o.getBounds().getSouthWest().getLat(),h=o.getBounds().getSouthWest().getLng(),S([[u,l],[h,l],[h,g],[u,g],[u,l]]).then(e=>{b(e),L.dispatch({type:"CHANGED_CENTER",COUNT:e.length})})})}async function S(a){return await(await fetch("http://localhost:5000/api/map/currentlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json()}async function b(a){a.forEach(n=>{const e=new t.maps.Marker({map:o,position:new t.maps.LatLng(n.location.coordinates[1],n.location.coordinates[0]),title:n.title,image:new t.maps.MarkerImage(n.certified?B:x,new t.maps.Size(24,35))});t.maps.event.addListener(e,"click",function(){const c=new t.maps.InfoWindow({zIndex:1});c.setContent(`<div style="padding:5px;font-size:12px;"><a href="/green-maps/search/${n._id.replaceAll(/ObjectId\('|'\)/g,"")}">${n.title}</a></div>`),c.open(o,e)})})}function I(a){new t.maps.services.Places().keywordSearch(a,e);function e(s,r,m){if(r===t.maps.services.Status.OK){const f=new t.maps.LatLngBounds;for(let d=0;d<s.length;d++)c(s[d]),f.extend(new t.maps.LatLng(s[d].y,s[d].x));o.setBounds(f)}}function c(s){const r=new t.maps.Marker({map:o,position:new t.maps.LatLng(s.y,s.x)});t.maps.event.addListener(r,"click",function(){const m=new t.maps.InfoWindow({zIndex:1});m.setContent('<div style="padding:5px;font-size:12px;">'+s.place_name+"</div>"),m.open(o,r)})}}function N(){function a(e){return e.target.value}function n(){const e=document.getElementById("searchItem").value;I(e)}return p(w,{children:[i("div",{className:"search-bar",children:p("div",{children:[i("label",{htmlFor:"searchItem",className:"sr-only",children:"식당 검색하기"}),i("input",{type:"text",id:"searchItem",onChange:a,autoFocus:!0})]})}),i("button",{type:"button",onClick:n,children:"검색"})]})}function E(){return p("div",{className:"top-bar search",children:[i(y,{}),i(N,{})]})}function O(){const a=k(()=>L.getState().map.COUNT);return p("button",{className:"button-count",type:"button",children:["검색된 식당 ",i("span",{children:a}),"개"]})}function F(){return v.useEffect(()=>{C()},[]),p(w,{children:[i(E,{}),i("div",{id:"map"}),i(O,{})]})}export{F as Page};
